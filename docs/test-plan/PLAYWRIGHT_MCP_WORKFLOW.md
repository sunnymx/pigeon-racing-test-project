# Playwright MCP æµ‹è¯•è°ƒé€‚æµç¨‹æŒ‡å—

## æ–‡æ¡£ä¿¡æ¯
- **é¡¹ç›®åç§°**: PIGEON_RACING_TEST_PROJECT
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-11-17
- **é€‚ç”¨å¯¹è±¡**: æµ‹è¯•å¼€å‘äººå‘˜
- **å‰ç½®é˜…è¯»**: [TEST_PLAN_OVERVIEW.md](./TEST_PLAN_OVERVIEW.md)

---

## ğŸ“‹ ç›®å½•

1. [Playwright MCP ç®€ä»‹](#playwright-mcp-ç®€ä»‹)
2. [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
3. [äº¤äº’å¼æµ‹è¯•æµç¨‹](#äº¤äº’å¼æµ‹è¯•æµç¨‹)
4. [æµ‹è¯•ç”¨ä¾‹å¼€å‘æµç¨‹](#æµ‹è¯•ç”¨ä¾‹å¼€å‘æµç¨‹)
5. [è¾…åŠ©å‡½æ•°å¼€å‘æµç¨‹](#è¾…åŠ©å‡½æ•°å¼€å‘æµç¨‹)
6. [é—®é¢˜è°ƒè¯•æµç¨‹](#é—®é¢˜è°ƒè¯•æµç¨‹)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## Playwright MCP ç®€ä»‹

### ä»€ä¹ˆæ˜¯ Playwright MCPï¼Ÿ

Playwright MCP (Model Context Protocol) æ˜¯ä¸€ä¸ªå…è®¸é€šè¿‡ Claude Code è¿›è¡Œäº¤äº’å¼æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„å·¥å…·ã€‚å®ƒæä¾›äº†ï¼š

- âœ… **è‡ªç„¶è¯­è¨€äº¤äº’** - ç”¨äººç±»è¯­è¨€æè¿°æµ‹è¯•æ­¥éª¤
- âœ… **å®æ—¶é¡µé¢çŠ¶æ€** - é€šè¿‡ accessibility snapshot æŸ¥çœ‹é¡µé¢ç»“æ„
- âœ… **è§†è§‰éªŒè¯** - æˆªå›¾å’Œè§†è§‰å¯¹æ¯”
- âœ… **ç½‘ç»œç›‘æ§** - æŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
- âœ… **æ§åˆ¶å°æ—¥å¿—** - æ£€æŸ¥ JavaScript é”™è¯¯

### ä¸ºä»€ä¹ˆä½¿ç”¨ Playwright MCPï¼Ÿ

ç›¸æ¯”ä¼ ç»Ÿçš„ Playwright è„šæœ¬å¼€å‘ï¼š

| ç‰¹æ€§ | ä¼ ç»Ÿæ–¹å¼ | Playwright MCP |
|------|---------|----------------|
| å­¦ä¹ æ›²çº¿ | éœ€è¦å­¦ä¹  Playwright API | è‡ªç„¶è¯­è¨€äº¤äº’ |
| è°ƒè¯•é€Ÿåº¦ | å†™ä»£ç  â†’ è¿è¡Œ â†’ è°ƒè¯• | å³æ—¶äº¤äº’å¼è°ƒè¯• |
| å…ƒç´ å®šä½ | æ‰‹åŠ¨æŸ¥æ‰¾é€‰æ‹©å™¨ | AI è¾…åŠ©å®šä½ |
| é”™è¯¯è¯Šæ–­ | æŸ¥çœ‹æ—¥å¿—å’Œæˆªå›¾ | å®æ—¶äº¤äº’å¼æ’æŸ¥ |
| æ–‡æ¡£è®°å½• | æ‰‹åŠ¨ç¼–å†™ | è‡ªåŠ¨è®°å½•æ“ä½œè¿‡ç¨‹ |

---

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. éªŒè¯ Playwright MCP å®‰è£…

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„ MCP æœåŠ¡
claude mcp list

# é¢„æœŸè¾“å‡ºåº”åŒ…å«ï¼š
# playwright - npx @playwright/mcp@latest
```

### 2. å¯åŠ¨ Claude Code

```bash
# åœ¨é¡¹ç›®ç›®å½•ä¸‹å¯åŠ¨
cd /path/to/pigeon-racing-test-project
claude
```

### 3. éªŒè¯é…ç½®

åœ¨ Claude Code ä¸­æ‰§è¡Œï¼š

```
ä½¿ç”¨ playwright mcp æ‰“å¼€ https://skyracing.com.cn
```

å¦‚æœæˆåŠŸï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
- æµè§ˆå™¨çª—å£æ‰“å¼€
- é¡µé¢åŠ è½½å®Œæˆ
- Claude è¿”å›é¡µé¢ snapshot ä¿¡æ¯

---

## äº¤äº’å¼æµ‹è¯•æµç¨‹

### é˜¶æ®µ 1: æ¢ç´¢å¼æµ‹è¯•ï¼ˆå‚è€ƒ TEST_REPORT.md ç»éªŒï¼‰

æ ¹æ® [TEST_REPORT.md](../TEST_REPORT.md) çš„æˆåŠŸç»éªŒï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œæ¢ç´¢ï¼š

#### Step 1: æ‰“å¼€ç½‘ç«™å¹¶éªŒè¯é¦–é¡µ

```
ä½¿ç”¨ playwright mcp æ‰“å¼€ https://skyracing.com.cn
ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
æˆªå›¾ä¿å­˜ä¸º homepage.png
```

**éªŒè¯ç‚¹**ï¼š
- âœ… é¡µé¢æ ‡é¢˜ä¸º "Skyracing GPS pigeon tracker"
- âœ… è‡³å°‘æ˜¾ç¤º 10 ä¸ªèµ›äº‹å¡ç‰‡
- âœ… æ— æ§åˆ¶å°é”™è¯¯

#### Step 2: è¿›å…¥èµ›äº‹è¯¦æƒ…

```
ç‚¹å‡»ç¬¬ä¸€ä¸ªèµ›äº‹çš„ã€Œè¿›å…¥ã€æŒ‰é’®
ç­‰å¾…é¡µé¢åŠ è½½
è·å–é¡µé¢ snapshot
```

**éªŒè¯ç‚¹**ï¼š
- âœ… æ’ååˆ—è¡¨è¡¨æ ¼æ˜¾ç¤º
- âœ… è‡³å°‘ 50 è¡Œæ•°æ®
- âœ… ã€ŒæŸ¥çœ‹è½¨è¿¹ã€æŒ‰é’®æ˜¾ç¤ºï¼ˆç¦ç”¨çŠ¶æ€ï¼‰

#### Step 3: é€‰æ‹©é¸½å­å¹¶æŸ¥çœ‹è½¨è¿¹

```
å‹¾é€‰æ’åç¬¬ä¸€çš„é¸½å­
éªŒè¯ã€Œå‹¾é€‰æ¸…å•ã€æ˜¾ç¤ºä¸º 1
ç‚¹å‡»ã€ŒæŸ¥çœ‹è½¨è¿¹ã€æŒ‰é’®
ç­‰å¾…è½¨è¿¹è§†å›¾åŠ è½½ï¼ˆç­‰å¾… 5 ç§’ï¼‰
```

**éªŒè¯ç‚¹**ï¼š
- âœ… è½¨è¿¹è§†å›¾æˆåŠŸåŠ è½½
- âœ… ä¾§è¾¹æ æ˜¾ç¤ºé¸½å­è¯¦æƒ…
- âœ… åœ°å›¾å®¹å™¨å¯è§

#### Step 4: åˆ‡æ¢åˆ° 2D æ¨¡å¼ï¼ˆå…³é”®æ­¥éª¤ï¼‰

âš ï¸ **é‡è¦**ï¼šæ ¹æ® [KNOWN_ISSUES_SOLUTIONS.md](./KNOWN_ISSUES_SOLUTIONS.md) é—®é¢˜#1ï¼Œå¿…é¡»ä½¿ç”¨ 3Dâ†’2D åˆ‡æ¢åºåˆ—ã€‚

```
# ç¬¬ä¸€æ­¥ï¼šç¡®ä¿åœ¨ 3D æ¨¡å¼
æ£€æŸ¥æ˜¯å¦æœ‰ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®
å¦‚æœæœ‰ã€Œ3Dæ¨¡å¼ã€æŒ‰é’®ï¼Œå…ˆç‚¹å‡»å®ƒåˆ‡æ¢åˆ° 3D
ç­‰å¾… 1 ç§’

# ç¬¬äºŒæ­¥ï¼šåˆ‡æ¢åˆ° 2D æ¨¡å¼
ç‚¹å‡»ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®
ç­‰å¾… 2 ç§’

# ç¬¬ä¸‰æ­¥ï¼šéªŒè¯åœ°å›¾ç“¦ç‰‡åŠ è½½
è·å–é¡µé¢ snapshot
æ£€æŸ¥åœ°å›¾å®¹å™¨å†…çš„ img å…ƒç´ æ•°é‡
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æŒ‰é’®æ–‡å­—å˜ä¸ºã€Œ3Dæ¨¡å¼ã€ï¼ˆè¡¨ç¤ºå½“å‰åœ¨ 2Dï¼‰
- âœ… åœ°å›¾ç“¦ç‰‡æ•°é‡ > 50
- âœ… æ—  "gpx2d undefined" é”™è¯¯

#### Step 5: ç¡®ä¿é™æ€æ¨¡å¼

```
è·å–é¡µé¢ snapshot
æŸ¥æ‰¾æ‰€æœ‰ title åŒ…å« "2025-26-" çš„å…ƒç´ 
å¦‚æœå°‘äº 3 ä¸ªï¼Œç‚¹å‡» timeline æŒ‰é’®
ç­‰å¾… 1 ç§’åå†æ¬¡æ£€æŸ¥
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… å¯è§ â‰¥3 ä¸ªè½¨è¿¹æ ‡è®°ç‚¹
- âœ… çº¢è‰²è½¨è¿¹çº¿å®Œæ•´æ˜¾ç¤º

#### Step 6: ç‚¹å‡»è½¨è¿¹ç‚¹æŸ¥çœ‹ä¿¡æ¯

```
è·å–é¡µé¢ snapshot
æ‰¾åˆ°æ‰€æœ‰ title åŒ…å« "2025-26-" çš„å…ƒç´ 
ç‚¹å‡»ä¸­é—´çš„ä¸€ä¸ªå…ƒç´ 
ç­‰å¾…ä¿¡æ¯çª—æ ¼æ˜¾ç¤º
æˆªå›¾ä¿å­˜
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç™½è‰²ä¿¡æ¯çª—æ ¼å‡ºç°
- âœ… æ˜¾ç¤ºï¼šå…¬ç¯å·ã€æ—¶é—´ã€é€Ÿåº¦ã€æ–¹å‘ã€æµ·æ‹”ã€åæ¬¡

---

### é˜¶æ®µ 2: æ•°æ®æå–ä¸éªŒè¯

#### æå–ä¾§è¾¹æ æ•°æ®

```
è·å–é¡µé¢ snapshot
æå–è½¨è¿¹è¯¦æƒ…é¢æ¿çš„æ‰€æœ‰æ•°æ®ï¼š
- å…¬ç¯å·
- èµ·ç‚¹æ—¶é—´ / ç»ˆç‚¹æ—¶é—´
- æŒç»­æ—¶é—´
- å¹³å‡åˆ†é€Ÿ / æœ€é«˜åˆ†é€Ÿ
- å¹³å‡é«˜åº¦ / æœ€å¤§é«˜åº¦
- å®é™…è·ç¦» / ç›´çº¿è·ç¦»
```

å‚è€ƒ [TEST_CASES.md - TC-06-001](./TEST_CASES.md#tc-06-001-ä¾§è¾¹æ æ•°æ®å®Œæ•´æ€§éªŒè¯) éªŒè¯æ•°æ®æ ¼å¼ã€‚

#### ç›‘å¬ç½‘ç»œè¯·æ±‚

```
æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œè¯·æ±‚
è¿‡æ»¤åŒ…å« "ugetPigeonAllJsonInfo" çš„è¯·æ±‚
æ£€æŸ¥å“åº”æ•°æ®
```

å‚è€ƒ [API_ENDPOINTS.md](../api-reference/API_ENDPOINTS.md) éªŒè¯ API å“åº”æ ¼å¼ã€‚

#### æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

```
æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ¶ˆæ¯
è¿‡æ»¤é”™è¯¯ç±»å‹çš„æ¶ˆæ¯
```

å¯¹æ¯” [KNOWN_ISSUES_SOLUTIONS.md](./KNOWN_ISSUES_SOLUTIONS.md) æ£€æŸ¥æ˜¯å¦ä¸ºå·²çŸ¥é”™è¯¯ã€‚

---

## æµ‹è¯•ç”¨ä¾‹å¼€å‘æµç¨‹

### æµç¨‹æ¦‚è§ˆ

```
1. é€‰æ‹©æµ‹è¯•ç”¨ä¾‹ (TEST_CASES.md)
     â†“
2. ä½¿ç”¨ MCP äº¤äº’å¼éªŒè¯
     â†“
3. è®°å½•æˆåŠŸçš„æ“ä½œæ­¥éª¤
     â†“
4. è½¬æ¢ä¸º TypeScript ä»£ç 
     â†“
5. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯
```

### è¯¦ç»†æ­¥éª¤

#### Step 1: é€‰æ‹©æµ‹è¯•ç”¨ä¾‹

ä» [TEST_CASES.md](./TEST_CASES.md) ä¸­é€‰æ‹©ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå»ºè®®æŒ‰ä¼˜å…ˆçº§é¡ºåºï¼š

1. **P0 ä¼˜å…ˆçº§**ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
   - TC-02-002: åˆ‡æ¢åˆ°2Dæ¨¡å¼
   - TC-02-003: ç¡®ä¿é™æ€æ¨¡å¼
   - TC-02-004: ç‚¹å‡»è½¨è¿¹ç‚¹æŸ¥çœ‹ä¿¡æ¯

2. **P1 ä¼˜å…ˆçº§**ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
   - TC-03-002: æ’­æ”¾åŠŸèƒ½æµ‹è¯•
   - TC-04-001: åˆ‡æ¢åˆ°3Dæ¨¡å¼

3. **P2 ä¼˜å…ˆçº§**ï¼ˆè¾…åŠ©åŠŸèƒ½ï¼‰
   - TC-07-001: æŒ‰é’®çŠ¶æ€æµ‹è¯•

#### Step 2: ä½¿ç”¨ MCP äº¤äº’å¼éªŒè¯

**ç¤ºä¾‹ï¼šéªŒè¯ TC-02-002 (åˆ‡æ¢åˆ°2Dæ¨¡å¼)**

```
// åœ¨ Claude Code ä¸­æ‰§è¡Œä»¥ä¸‹å¯¹è¯ï¼š

1. æ‰“å¼€ç½‘ç«™ï¼š
   "ä½¿ç”¨ playwright mcp æ‰“å¼€ https://skyracing.com.cn"

2. è¿›å…¥èµ›äº‹ï¼š
   "ç‚¹å‡»ç¬¬ä¸€ä¸ªèµ›äº‹çš„è¿›å…¥æŒ‰é’®"

3. é€‰æ‹©é¸½å­ï¼š
   "å‹¾é€‰æ’åç¬¬ä¸€çš„é¸½å­ï¼Œç„¶åç‚¹å‡»æŸ¥çœ‹è½¨è¿¹"

4. ç­‰å¾…åŠ è½½ï¼š
   "ç­‰å¾… 5 ç§’è®©è½¨è¿¹è§†å›¾å®Œå…¨åŠ è½½"

5. æ‰§è¡Œ 3Dâ†’2D åˆ‡æ¢åºåˆ—ï¼š
   "æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®ï¼Œå¦‚æœæœ‰ã€Œ3Dæ¨¡å¼ã€æŒ‰é’®ï¼Œå…ˆç‚¹å‡»å®ƒ"
   "ç­‰å¾… 1 ç§’"
   "ç‚¹å‡»ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®"
   "ç­‰å¾… 2 ç§’"

6. éªŒè¯ç»“æœï¼š
   "è·å–é¡µé¢ snapshot"
   "ç»Ÿè®¡åœ°å›¾å®¹å™¨å†…çš„ img å…ƒç´ æ•°é‡"
   "æ£€æŸ¥æ˜¯å¦æœ‰ gpx2d undefined é”™è¯¯"
```

#### Step 3: è®°å½•æˆåŠŸæ­¥éª¤

åˆ›å»ºæµ‹è¯•ç¬”è®°ï¼Œè®°å½•ï¼š
- âœ… æˆåŠŸçš„æ“ä½œé¡ºåº
- âœ… å…³é”®çš„ç­‰å¾…æ—¶é—´
- âœ… é‡è¦çš„å…ƒç´ é€‰æ‹©å™¨
- âœ… éªŒè¯ç‚¹

**ç¤ºä¾‹ç¬”è®°**ï¼š

```markdown
## TC-02-002 æµ‹è¯•ç¬”è®°

### æˆåŠŸæµç¨‹
1. ç­‰å¾…æ—¶é—´ï¼šæŸ¥çœ‹è½¨è¿¹åéœ€ç­‰å¾… 5 ç§’
2. å…³é”®æ­¥éª¤ï¼šå¿…é¡»å…ˆç¡®ä¿åœ¨ 3D æ¨¡å¼
3. å…ƒç´ å®šä½ï¼š
   - 2DæŒ‰é’®ï¼šbutton:has-text("2Dæ¨¡å¼")
   - 3DæŒ‰é’®ï¼šbutton:has-text("3Dæ¨¡å¼")
4. éªŒè¯æ–¹æ³•ï¼š
   - åœ°å›¾ç“¦ç‰‡æ•°é‡ > 50
   - æŒ‰é’®æ–‡å­—å˜ä¸ºã€Œ3Dæ¨¡å¼ã€

### é‡åˆ°çš„é—®é¢˜
- âŒ ç›´æ¥åˆ‡æ¢åˆ° 2D å¤±è´¥ï¼ˆgpx2d undefinedï¼‰
- âœ… ä½¿ç”¨ 3Dâ†’2D åºåˆ—æˆåŠŸ

### ä»£ç ç‰‡æ®µ
```typescript
// 3Dâ†’2D åˆ‡æ¢åºåˆ—
const button2D = page.getByRole('button', { name: '2d 2Dæ¨¡å¼' });
const is2DMode = await button2D.isVisible();

if (!is2DMode) {
  await page.getByRole('button', { name: 'view_in_ar 3Dæ¨¡å¼' }).click();
  await page.waitForTimeout(1000);
}

await button2D.click();
await page.waitForTimeout(2000);

const tileCount = await page.locator('.amap-container img').count();
expect(tileCount).toBeGreaterThan(50);
```
```

#### Step 4: è½¬æ¢ä¸º TypeScript ä»£ç 

å‚è€ƒ [HELPER_FUNCTIONS_DESIGN.md](./HELPER_FUNCTIONS_DESIGN.md) çš„å‡½æ•°è®¾è®¡ï¼Œå°†äº¤äº’å¼æ­¥éª¤è½¬æ¢ä¸ºä»£ç ã€‚

**ç¤ºä¾‹è½¬æ¢**ï¼š

```typescript
// tests/e2e/02-track-2d-static.spec.ts

import { test, expect } from '@playwright/test';
import { enterFirstRace, selectPigeon, viewTrajectory } from '../helpers/navigation';
import { switchTo2DMode } from '../helpers/mode-switching';

test.describe('2D é™æ€è½¨è¿¹æµ‹è¯•', () => {
  test('TC-02-002: åˆ‡æ¢åˆ°2Dæ¨¡å¼', async ({ page }) => {
    // 1. å¯¼èˆªåˆ°è½¨è¿¹è§†å›¾
    await page.goto('https://skyracing.com.cn');
    await enterFirstRace(page);
    await selectPigeon(page, 0);
    await viewTrajectory(page);

    // 2. åˆ‡æ¢åˆ°2Dæ¨¡å¼ï¼ˆä½¿ç”¨å·²éªŒè¯çš„è§£å†³æ–¹æ¡ˆï¼‰
    const success = await switchTo2DMode(page, 2);

    // 3. éªŒè¯ç»“æœ
    expect(success).toBe(true);
    const tileCount = await page.locator('.amap-container img').count();
    expect(tileCount).toBeGreaterThan(50);
  });
});
```

#### Step 5: è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npx playwright test tests/e2e/02-track-2d-static.spec.ts

# è¿è¡Œå¹¶æŸ¥çœ‹æµè§ˆå™¨
npx playwright test tests/e2e/02-track-2d-static.spec.ts --headed

# è°ƒè¯•æ¨¡å¼
npx playwright test tests/e2e/02-track-2d-static.spec.ts --debug
```

---

## è¾…åŠ©å‡½æ•°å¼€å‘æµç¨‹

### æµç¨‹æ¦‚è§ˆ

```
1. é€‰æ‹©è¾…åŠ©å‡½æ•° (HELPER_FUNCTIONS_DESIGN.md)
     â†“
2. ä½¿ç”¨ MCP éªŒè¯å‡½æ•°é€»è¾‘
     â†“
3. å®ç° TypeScript ä»£ç 
     â†“
4. åˆ›å»ºæµ‹è¯•éªŒè¯
     â†“
5. é›†æˆåˆ°å…¶ä»–æµ‹è¯•ç”¨ä¾‹
```

### å¼€å‘ç¤ºä¾‹ï¼šswitchTo2DMode()

#### Step 1: é˜…è¯»å‡½æ•°è®¾è®¡

å‚è€ƒ [HELPER_FUNCTIONS_DESIGN.md - switchTo2DMode()](./HELPER_FUNCTIONS_DESIGN.md#21-switchto2dmode)

**å‡½æ•°ç­¾å**ï¼š
```typescript
async function switchTo2DMode(page: Page, retries: number = 2): Promise<boolean>
```

**åŠŸèƒ½**: åˆ‡æ¢åˆ° 2D æ¨¡å¼ï¼ˆä½¿ç”¨ 3Dâ†’2D åºåˆ—ï¼‰

#### Step 2: ä½¿ç”¨ MCP éªŒè¯é€»è¾‘

```
# åœ¨ Claude Code ä¸­æµ‹è¯•é€»è¾‘

1. "æ£€æŸ¥å½“å‰æ¨¡å¼ï¼š"
   è·å–é¡µé¢ snapshot
   æŸ¥æ‰¾ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®

2. "å¦‚æœå½“å‰åœ¨ 2Dï¼Œå…ˆåˆ‡æ¢åˆ° 3Dï¼š"
   ç‚¹å‡»ã€Œ3Dæ¨¡å¼ã€æŒ‰é’®
   ç­‰å¾… 1 ç§’

3. "åˆ‡æ¢åˆ° 2Dï¼š"
   ç‚¹å‡»ã€Œ2Dæ¨¡å¼ã€æŒ‰é’®
   ç­‰å¾… 2 ç§’

4. "éªŒè¯åœ°å›¾ç“¦ç‰‡ï¼š"
   ç»Ÿè®¡ .amap-container img å…ƒç´ æ•°é‡
   é¢„æœŸ > 50

5. "å¦‚æœå¤±è´¥ï¼Œé‡è¯•ä¸€æ¬¡"
```

#### Step 3: å®ç°ä»£ç 

```typescript
// tests/helpers/mode-switching.ts

import { Page, expect } from '@playwright/test';

/**
 * åˆ‡æ¢åˆ°2Dæ¨¡å¼ï¼ˆä½¿ç”¨3Dâ†’2Dåˆ‡æ¢åºåˆ—ç¡®ä¿æ•°æ®åŠ è½½ï¼‰
 * åŸºäº TEST_REPORT.md é—®é¢˜#1 çš„è§£å†³æ–¹æ¡ˆ
 *
 * @param page Playwright Page å¯¹è±¡
 * @param retries é‡è¯•æ¬¡æ•°
 * @returns æˆåŠŸè¿”å› true
 */
export async function switchTo2DMode(
  page: Page,
  retries: number = 2
): Promise<boolean> {
  for (let i = 0; i < retries; i++) {
    try {
      // æ­¥éª¤1: ç¡®ä¿å…ˆåœ¨3Dæ¨¡å¼
      const button2D = page.getByRole('button', { name: '2d 2Dæ¨¡å¼' });
      const is2DMode = await button2D.isVisible().catch(() => false);

      if (!is2DMode) {
        const button3D = page.getByRole('button', { name: 'view_in_ar 3Dæ¨¡å¼' });
        if (await button3D.isVisible().catch(() => false)) {
          await button3D.click();
          await page.waitForTimeout(1000);
        }
      }

      // æ­¥éª¤2: åˆ‡æ¢åˆ°2Dæ¨¡å¼
      await button2D.click();
      await page.waitForTimeout(2000);

      // æ­¥éª¤3: éªŒè¯åœ°å›¾ç“¦ç‰‡åŠ è½½
      const tileCount = await page.locator('.amap-container img').count();

      if (tileCount > 50) {
        console.log(`âœ… 2Dæ¨¡å¼åˆ‡æ¢æˆåŠŸï¼Œåœ°å›¾ç“¦ç‰‡æ•°: ${tileCount}`);
        return true;
      } else {
        console.warn(`âš ï¸ åœ°å›¾ç“¦ç‰‡ä¸è¶³ (${tileCount})ï¼Œé‡è¯•...`);
      }
    } catch (error) {
      console.error(`âŒ ç¬¬ ${i + 1} æ¬¡åˆ‡æ¢å¤±è´¥:`, error);
      if (i === retries - 1) throw error;
    }
  }

  throw new Error('åˆ‡æ¢åˆ°2Dæ¨¡å¼å¤±è´¥');
}
```

#### Step 4: åˆ›å»ºæµ‹è¯•éªŒè¯

```typescript
// tests/helpers/mode-switching.test.ts

import { test, expect } from '@playwright/test';
import { switchTo2DMode } from './mode-switching';
import { enterFirstRace, selectPigeon, viewTrajectory } from './navigation';

test.describe('è¾…åŠ©å‡½æ•°æµ‹è¯• - mode-switching', () => {
  test('switchTo2DMode åº”è¯¥æˆåŠŸåˆ‡æ¢åˆ°2Dæ¨¡å¼', async ({ page }) => {
    // å‡†å¤‡ï¼šè¿›å…¥è½¨è¿¹è§†å›¾
    await page.goto('https://skyracing.com.cn');
    await enterFirstRace(page);
    await selectPigeon(page, 0);
    await viewTrajectory(page);

    // æ‰§è¡Œï¼šåˆ‡æ¢åˆ°2Dæ¨¡å¼
    const result = await switchTo2DMode(page, 2);

    // éªŒè¯ï¼š
    expect(result).toBe(true);

    // é¢å¤–éªŒè¯æŒ‰é’®æ–‡å­—
    const button3D = page.getByRole('button', { name: 'view_in_ar 3Dæ¨¡å¼' });
    await expect(button3D).toBeVisible();

    // éªŒè¯åœ°å›¾ç“¦ç‰‡
    const tileCount = await page.locator('.amap-container img').count();
    expect(tileCount).toBeGreaterThan(50);
  });
});
```

#### Step 5: åœ¨ MCP ä¸­éªŒè¯

```
è¿è¡Œæµ‹è¯•ï¼š
npx playwright test tests/helpers/mode-switching.test.ts --headed

å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œä½¿ç”¨ playwright mcp å†æ¬¡æ‰‹åŠ¨éªŒè¯ï¼š
"ä½¿ç”¨ playwright mcp æ‰“å¼€ https://skyracing.com.cn"
[æ‰§è¡Œå‡†å¤‡æ­¥éª¤...]
"è°ƒç”¨ switchTo2DMode å‡½æ•°"
"éªŒè¯ç»“æœ"
```

---

## é—®é¢˜è°ƒè¯•æµç¨‹

### é‡åˆ°é—®é¢˜æ—¶çš„æ­¥éª¤

#### 1. å¤ç°é—®é¢˜ï¼ˆä½¿ç”¨ MCPï¼‰

```
# ç²¾ç¡®å¤ç°å¤±è´¥çš„æµ‹è¯•æ­¥éª¤

"ä½¿ç”¨ playwright mcp æ‰“å¼€ https://skyracing.com.cn"
[æ‰§è¡Œæ­¥éª¤ 1]
[æ‰§è¡Œæ­¥éª¤ 2]
...
[åœ¨å“ªä¸€æ­¥å¤±è´¥ï¼Ÿ]
```

#### 2. æ”¶é›†è¯Šæ–­ä¿¡æ¯

```
# è·å–é¡µé¢çŠ¶æ€
"è·å–é¡µé¢ snapshot"

# æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
"æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ¶ˆæ¯ï¼Œåªæ˜¾ç¤ºé”™è¯¯"

# æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
"æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œè¯·æ±‚"

# æˆªå›¾å½“å‰çŠ¶æ€
"æˆªå›¾ä¿å­˜ä¸º debug-screenshot.png"
```

#### 3. å¯¹æ¯”å·²çŸ¥é—®é¢˜

æŸ¥é˜… [KNOWN_ISSUES_SOLUTIONS.md](./KNOWN_ISSUES_SOLUTIONS.md) æ£€æŸ¥æ˜¯å¦ä¸ºå·²çŸ¥é—®é¢˜ï¼š

| é”™è¯¯ç‰¹å¾ | å·²çŸ¥é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| `gpx2d undefined` | é—®é¢˜#1 | ä½¿ç”¨ 3Dâ†’2D åˆ‡æ¢åºåˆ— |
| æ ‡è®°ç‚¹ < 3 | é—®é¢˜#2 | ç‚¹å‡» timeline åˆ‡æ¢æ¨¡å¼ |
| ç‚¹å‡»è½¨è¿¹ç‚¹æ— å“åº” | é—®é¢˜#3 | ä½¿ç”¨ title é€‰æ‹©å™¨è€Œéåæ ‡ |
| æ•°æ®æœªå®šä¹‰é”™è¯¯ | é—®é¢˜#4 | å¢åŠ ç­‰å¾…æ—¶é—´ |

#### 4. è¿­ä»£è°ƒè¯•

```
# å°è¯•è§£å†³æ–¹æ¡ˆ 1
"å¢åŠ ç­‰å¾…æ—¶é—´åˆ° 5 ç§’"
"é‡æ–°æ‰§è¡Œæ­¥éª¤"
"æ£€æŸ¥æ˜¯å¦æˆåŠŸ"

# å¦‚æœå¤±è´¥ï¼Œå°è¯•è§£å†³æ–¹æ¡ˆ 2
"ä½¿ç”¨ 3Dâ†’2D åˆ‡æ¢åºåˆ—"
"é‡æ–°æ‰§è¡Œ"
"æ£€æŸ¥ç»“æœ"

# è®°å½•æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ
```

#### 5. æ›´æ–°æ–‡æ¡£

å¦‚æœå‘ç°æ–°é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

1. åœ¨ [KNOWN_ISSUES_SOLUTIONS.md](./KNOWN_ISSUES_SOLUTIONS.md) æ·»åŠ æ–°é—®é¢˜
2. åœ¨ [HELPER_FUNCTIONS_DESIGN.md](./HELPER_FUNCTIONS_DESIGN.md) æ›´æ–°ç›¸å…³å‡½æ•°
3. åœ¨ [TEST_CASES.md](./TEST_CASES.md) æ›´æ–°æµ‹è¯•ç”¨ä¾‹

---

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•å¼€å‘é¡ºåº

**æ¨èé¡ºåº**ï¼š

```
Phase 1: åŸºç¡€åŠŸèƒ½éªŒè¯ï¼ˆä½¿ç”¨ MCPï¼‰
  â”œâ”€ é¡µé¢åŠ è½½
  â”œâ”€ åŸºç¡€å¯¼èˆª
  â””â”€ æ•°æ®æ˜¾ç¤º

Phase 2: æ ¸å¿ƒåŠŸèƒ½éªŒè¯ï¼ˆMCP + ä»£ç ï¼‰
  â”œâ”€ 2D æ¨¡å¼åˆ‡æ¢
  â”œâ”€ è½¨è¿¹ç‚¹ç‚¹å‡»
  â””â”€ æ•°æ®æå–

Phase 3: è¾…åŠ©å‡½æ•°å¼€å‘ï¼ˆä»£ç ä¸ºä¸»ï¼‰
  â”œâ”€ navigation.ts
  â”œâ”€ mode-switching.ts
  â””â”€ trajectory-utils.ts

Phase 4: å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
  â”œâ”€ P0 æµ‹è¯•
  â”œâ”€ P1 æµ‹è¯•
  â””â”€ P2 æµ‹è¯•
```

### 2. MCP ä½¿ç”¨æ—¶æœº

**é€‚åˆä½¿ç”¨ MCP**ï¼š
- âœ… åˆæ¬¡æ¢ç´¢ç½‘ç«™åŠŸèƒ½
- âœ… è°ƒè¯•ç‰¹å®šé—®é¢˜
- âœ… éªŒè¯å…ƒç´ é€‰æ‹©å™¨
- âœ… æå–æ•°æ®ç¤ºä¾‹
- âœ… å¿«é€ŸéªŒè¯è§£å†³æ–¹æ¡ˆ

**åº”è¯¥å†™ä»£ç **ï¼š
- âœ… å·²éªŒè¯çš„é‡å¤æ€§æµ‹è¯•
- âœ… å›å½’æµ‹è¯•
- âœ… CI/CD è‡ªåŠ¨åŒ–
- âœ… æ€§èƒ½æµ‹è¯•

### 3. æ–‡æ¡£åŒæ­¥æ›´æ–°

æ¯æ¬¡ä½¿ç”¨ MCP å‘ç°æ–°ç»éªŒæ—¶ï¼š

```
å‘ç° â†’ éªŒè¯ â†’ è®°å½• â†’ æ›´æ–°æ–‡æ¡£ â†’ ç¼–ç å®ç°
```

**æ›´æ–°æ¸…å•**ï¼š
- [ ] æ˜¯å¦éœ€è¦æ›´æ–° KNOWN_ISSUES_SOLUTIONS.mdï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦æ›´æ–° HELPER_FUNCTIONS_DESIGN.mdï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦æ›´æ–° TEST_CASES.mdï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦æ›´æ–° API_ENDPOINTS.mdï¼Ÿ

### 4. æˆªå›¾å’Œè¯æ®ä¿å­˜

```bash
# åˆ›å»ºæµ‹è¯•è¯æ®ç›®å½•
mkdir -p tests/evidence/{screenshots,videos,logs}

# åœ¨ MCP ä¸­ä¿å­˜æˆªå›¾
"æˆªå›¾ä¿å­˜ä¸º tests/evidence/screenshots/feature-name-step1.png"

# ä¿å­˜ç½‘ç»œè¯·æ±‚æ—¥å¿—
"å°†ç½‘ç»œè¯·æ±‚ä¿å­˜åˆ°æ–‡ä»¶"
```

### 5. æµ‹è¯•ç¬”è®°æ¨¡æ¿

åˆ›å»º `tests/notes/` ç›®å½•ï¼Œä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åˆ›å»ºç¬”è®°ï¼š

```markdown
# TC-XX-XXX æµ‹è¯•ç¬”è®°

## æµ‹è¯•æ—¥æœŸ
YYYY-MM-DD

## MCP äº¤äº’è®°å½•
[äº¤äº’å¼æµ‹è¯•çš„å‘½ä»¤å’Œç»“æœ]

## å…³é”®å‘ç°
- å‘ç° 1
- å‘ç° 2

## å…ƒç´ é€‰æ‹©å™¨
- å…ƒç´  1: `selector`
- å…ƒç´  2: `selector`

## ç­‰å¾…æ—¶é—´
- æ“ä½œ A åç­‰å¾…: X ç§’
- æ“ä½œ B åç­‰å¾…: Y ç§’

## å·²çŸ¥é—®é¢˜
- é—®é¢˜ #X (å‚è€ƒ KNOWN_ISSUES_SOLUTIONS.md)

## ä»£ç ç‰‡æ®µ
```typescript
// å…³é”®ä»£ç 
```

## æˆªå›¾
- screenshot1.png
- screenshot2.png
```

---

## å¿«é€Ÿå‚è€ƒ

### MCP å¸¸ç”¨å‘½ä»¤

```bash
# åŸºç¡€æ“ä½œ
"ä½¿ç”¨ playwright mcp æ‰“å¼€ <URL>"
"ç‚¹å‡» <å…ƒç´ æè¿°>"
"è¾“å…¥ <æ–‡æœ¬> åˆ° <è¾“å…¥æ¡†>"
"ç­‰å¾… X ç§’"
"è·å–é¡µé¢ snapshot"
"æˆªå›¾ä¿å­˜ä¸º <æ–‡ä»¶å>"

# éªŒè¯
"æ£€æŸ¥é¡µé¢æ˜¯å¦åŒ…å« <æ–‡æœ¬>"
"éªŒè¯ <å…ƒç´ > æ˜¯å¦å¯è§"
"ç»Ÿè®¡ <å…ƒç´ > çš„æ•°é‡"

# è°ƒè¯•
"æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ¶ˆæ¯"
"æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œè¯·æ±‚"
"è¿‡æ»¤åŒ…å« <å…³é”®è¯> çš„è¯·æ±‚"
```

### å·¥ä½œæµé€ŸæŸ¥

| é˜¶æ®µ | å·¥å…· | äº§å‡º |
|------|------|------|
| æ¢ç´¢ | MCP | æ“ä½œæ­¥éª¤ã€æˆªå›¾ |
| éªŒè¯ | MCP | æµ‹è¯•ç¬”è®° |
| å¼€å‘ | VS Code | TypeScript ä»£ç  |
| æµ‹è¯• | Playwright | æµ‹è¯•æŠ¥å‘Š |
| æ–‡æ¡£ | Markdown | æ›´æ–°æ–‡æ¡£ |

---

## ç›¸å…³æ–‡æ¡£

- [TEST_PLAN_OVERVIEW.md](./TEST_PLAN_OVERVIEW.md) - æµ‹è¯•è®¡åˆ’æ€»è§ˆ
- [TEST_CASES.md](./TEST_CASES.md) - è¯¦ç»†æµ‹è¯•ç”¨ä¾‹
- [HELPER_FUNCTIONS_DESIGN.md](./HELPER_FUNCTIONS_DESIGN.md) - è¾…åŠ©å‡½æ•°è®¾è®¡
- [KNOWN_ISSUES_SOLUTIONS.md](./KNOWN_ISSUES_SOLUTIONS.md) - å·²çŸ¥é—®é¢˜è§£å†³æ–¹æ¡ˆ
- [API_ENDPOINTS.md](../api-reference/API_ENDPOINTS.md) - API æ¥å£å‚è€ƒ
- [TEST_REPORT.md](../TEST_REPORT.md) - äº¤äº’æµ‹è¯•æŠ¥å‘Š
- [GIT_SETUP.md](../GIT_SETUP.md) - Git é…ç½®æŒ‡å—

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-11-17
**ç»´æŠ¤è€…**: æµ‹è¯•å›¢é˜Ÿ
