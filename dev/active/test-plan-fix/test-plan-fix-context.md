# Test Plan Fix - Context & Key Decisions

**å°ˆæ¡ˆ**: é´¿å­ç«¶è³½ GPS è¿½è¹¤ç³»çµ±è‡ªå‹•åŒ–æ¸¬è©¦ä¿®å¾©
**å»ºç«‹æ—¥æœŸ**: 2025-11-21
**æœ€å¾Œæ›´æ–°**: 2025-11-25 11:07

---

## ğŸ“Š ç•¶å‰ç‹€æ…‹ (2025-11-25)

| æ¸¬è©¦å¥—ä»¶ | é€šé | å¤±æ•— | é€šéç‡ |
|----------|------|------|--------|
| TC-02-001 (2D éœæ…‹) | 2 | 2 | 50% |
| TC-03-001 (æ¨¡å¼åˆ‡æ›) | 0 | 5 | 0% |
| TC-04-001 (3D æ¨¡å¼) | 5 | 2 | 71% |
| **ç¸½è¨ˆ** | **7** | **9** | **43.75%** |

**Phase 1 ç‹€æ…‹**: âœ… å®Œæˆ (åŸºç·šæå‡ +31.25%)
**ç•¶å‰éšæ®µ**: Phase 2 æº–å‚™ä¸­

---

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™

ä¿®å¾© P0 æ¸¬è©¦å¥—ä»¶ï¼Œå°‡æ¸¬è©¦é€šéç‡å¾ 12.5% (2/16) æå‡åˆ°è‡³å°‘ 75% (12/16)ã€‚

**ç›®æ¨™èª¿æ•´** (2025-11-25):
- Phase 2 ç›®æ¨™: 56.25% (9/16)
- Phase 3 ç›®æ¨™: 75% (12/16)

---

## ğŸ“ é—œéµæª”æ¡ˆæ¸…å–®

### éœ€è¦ä¿®æ”¹çš„æª”æ¡ˆ

#### é«˜å„ªå…ˆç´šï¼ˆPhase 1ï¼‰
```
tests/helpers/navigation.ts
â”œâ”€ Line 124-142: getCurrentMode() å‡½æ•¸ â† ä¸»è¦ä¿®å¾©ç›®æ¨™
â””â”€ å½±éŸ¿: 7 å€‹æ¸¬è©¦ï¼ˆTC-03-001:144, TC-04-001 å…¨éƒ¨ 6 å€‹ï¼‰
```

#### ä¸­å„ªå…ˆç´šï¼ˆPhase 2ï¼‰
```
tests/e2e/tc-02-001-2d-static.spec.ts
â”œâ”€ Line 60: Timeline button selector
â””â”€ Line 129: Marker detection é‚è¼¯
```

#### ä½å„ªå…ˆç´šï¼ˆPhase 3ï¼‰
```
tests/e2e/tc-03-001-mode-switch.spec.ts
â”œâ”€ Line 33: éœæ…‹â†’å‹•æ…‹â†’éœæ…‹åˆ‡æ›æ¸¬è©¦
â”œâ”€ Line 90: å‹•æ…‹æ¨¡å¼æ’­æ”¾æ§åˆ¶æ¸¬è©¦
â”œâ”€ Line 111: å‹•æ…‹æ¨¡å¼æ’­æ”¾åŠŸèƒ½æ¸¬è©¦
â””â”€ Line 170: Canvas æ›´æ–°æ¸¬è©¦
```

### åƒè€ƒæª”æ¡ˆï¼ˆå”¯è®€ï¼‰

```
docs/test-plan/
â”œâ”€ TEST_PLAN_OVERVIEW.md - æ¸¬è©¦è¨ˆåŠƒç¸½è¦½
â”œâ”€ TEST_CASES.md - è©³ç´°æ¸¬è©¦æ¡ˆä¾‹
â””â”€ KNOWN_ISSUES_SOLUTIONS.md - å·²çŸ¥å•é¡Œè§£æ±ºæ–¹æ¡ˆï¼ˆéœ€æ›´æ–°ï¼‰

docs/guides/
â”œâ”€ mode-switching.md - 2D/3D æ¨¡å¼åˆ‡æ›æ·±åº¦æŒ‡å—
â”œâ”€ troubleshooting.md - æ•…éšœæ’é™¤æŒ‡å—
â”œâ”€ testing-strategies.md - æ¸¬è©¦ç­–ç•¥ï¼ˆä¸‰é‡é©—è­‰ï¼‰
â””â”€ playwright-workflow.md - Playwright MCP å·¥ä½œæµç¨‹

docs/architecture/
â””â”€ test-framework.md - æ¸¬è©¦æ¡†æ¶æ¶æ§‹è¨­è¨ˆ

dev/æ¸¬è©¦è¨ˆåŠƒä¿®å¾©ä½œæ¥­1121/
â””â”€ FIX_PLAN.md - åŸå§‹ä¿®å¾©è¨ˆåŠƒï¼ˆæœ¬å°ˆæ¡ˆçš„åŸºç¤ï¼‰

test-summary-report.md - 2025-11-21 æ¸¬è©¦åŸ·è¡Œå ±å‘Š
```

### é…ç½®æª”æ¡ˆ
```
playwright.config.ts - Playwright æ¸¬è©¦é…ç½®
tsconfig.json - TypeScript é…ç½®
package.json - å°ˆæ¡ˆä¾è³´å’Œè…³æœ¬
```

---

## ğŸ”‘ æ ¸å¿ƒæ±ºç­–è¨˜éŒ„

### Decision 1: getCurrentMode() ä¿®å¾©æ–¹æ¡ˆé¸æ“‡

**æ±ºç­–**: æ¡ç”¨æ–¹æ¡ˆ Bï¼ˆå¤šé‡æª¢æ¸¬ï¼‰è€Œéæ–¹æ¡ˆ Aï¼ˆå¿«é€Ÿä¿®å¾©ï¼‰

**ç†ç”±**:
1. **ç©©å¥æ€§**: ä¸‰å±¤æª¢æ¸¬ï¼ˆè¦–è§’æŒ‰éˆ• â†’ æ¨¡å¼æŒ‰éˆ•æ–‡å­— â†’ åœ°åœ–å®¹å™¨ï¼‰æä¾›å¤šé‡å¾Œå‚™
2. **å¯èª¿è©¦æ€§**: è©³ç´°æ—¥èªŒè¼¸å‡ºä¾¿æ–¼å•é¡Œè¿½è¹¤
3. **æœªä¾†å…¼å®¹**: æ¸›å°‘å°å–®ä¸€ UI å…ƒç´ çš„ä¾è³´
4. **é¢¨éšªè¼ƒä½**: å³ä½¿ä¸€å±¤å¤±æ•—ï¼Œä»æœ‰å¾Œå‚™ç­–ç•¥

**æ–¹æ¡ˆ Aï¼ˆè¢«æ‹’çµ•ï¼‰**:
```typescript
// ç°¡å–®ä½†è„†å¼±ï¼šåªæª¢æŸ¥æŒ‰éˆ•æ–‡å­—
if (buttonText.includes('3D')) return '2D';
if (buttonText.includes('2D')) return '3D';
```

**æ–¹æ¡ˆ Bï¼ˆè¢«æ¡ç”¨ï¼‰**:
```typescript
// Layer 1: æª¢æŸ¥ 3D ç‰¹å¾µå…ƒç´ 
if (hasView1Button) return '3D';

// Layer 2: æª¢æŸ¥æ¨¡å¼æŒ‰éˆ•æ–‡å­—ï¼ˆé—œéµé‚è¼¯ï¼‰
if (buttonText.includes('3D')) return '2D';
if (buttonText.includes('2D')) return '3D';

// Layer 3: å¾Œå‚™ - æª¢æŸ¥åœ°åœ–å®¹å™¨
if (hasMapContainer) return '2D';

return 'unknown';
```

**å½±éŸ¿ç¯„åœ**: 7 å€‹æ¸¬è©¦ï¼ˆé æœŸ +50% é€šéç‡ï¼‰

**é¢¨éšª**: ä½ï¼ˆæœ‰å®Œæ•´å‚™ä»½å’Œå›æ»¾è¨ˆåŠƒï¼‰

---

### Decision 2: Phase åŸ·è¡Œå„ªå…ˆç´š

**æ±ºç­–**: Phase 1 å¿…é ˆå®Œæˆ > Phase 2 ç›¡é‡å®Œæˆ > Phase 3 å½ˆæ€§å®‰æ’

**ç†ç”±**:
- Phase 1 å½±éŸ¿ 7 å€‹æ¸¬è©¦ï¼ˆROI æœ€é«˜ï¼‰
- Phase 2 å½±éŸ¿ 2 å€‹æ¸¬è©¦ï¼ˆä¸­ç­‰ ROIï¼‰
- Phase 3 å½±éŸ¿ 4-5 å€‹æ¸¬è©¦ï¼ˆä½†å¯èƒ½åŒ…å«åŠŸèƒ½ bugï¼Œéœ€æ·±å…¥èª¿æŸ¥ï¼‰

**æ™‚é–“åˆ†é…**:
```
Phase 1: åš´æ ¼ 60 åˆ†é˜ä¸Šé™ï¼ˆå¿…é ˆå®Œæˆï¼‰
Phase 2: åš´æ ¼ 40 åˆ†é˜ä¸Šé™ï¼ˆé«˜å„ªå…ˆç´šï¼‰
Phase 3: å½ˆæ€§ 1-2 å°æ™‚ï¼ˆæ™‚é–“å…è¨±å†åšï¼‰
```

**æ™‚é–“è¶…æ”¯è™•ç†**:
- Phase 1 è¶…æ™‚ â†’ å›æ»¾ä¸¦é‡æ–°è©•ä¼°
- Phase 2 è¶…æ™‚ â†’ æ¨™è¨˜å•é¡Œï¼Œç¹¼çºŒ Phase 3
- Phase 3 è¶…æ™‚ â†’ è¨˜éŒ„æœªå®Œæˆé …ï¼Œå¾ŒçºŒè™•ç†

---

### Decision 3: Selector ç­–ç•¥é¸æ“‡

**æ±ºç­–**: å„ªå…ˆä½¿ç”¨ Role-based selectorï¼Œå…¶æ¬¡ Parent container + Roleï¼Œæœ€å¾Œæ‰ç”¨ CSS

**ç†ç”±**:
1. **ç©©å¥æ€§**: Role-based selector ä¸æ˜“å›  UI æ¨£å¼æ”¹è®Šè€Œå¤±æ•ˆ
2. **å¯è®€æ€§**: èªç¾©åŒ–çš„ selectorï¼ˆ`getByRole('button', { name: /timeline/i })`ï¼‰
3. **å¯ç¶­è­·æ€§**: æ¸›å°‘å°è„†å¼± CSS class çš„ä¾è³´

**å„ªå…ˆç´šé †åº**:
```
1. Role-based selector
   getByRole('button', { name: /timeline/i })

2. Parent container + Role selector
   page.locator('.control-panel').getByRole('button', { name: /timeline/i })

3. Text-based selector
   page.locator('button').filter({ hasText: /timeline/i })

4. API æ•¸æ“šé©—è­‰ï¼ˆå¦‚ DOM ä¸å¯è¡Œï¼‰
   const response = await page.waitForResponse(/ugetPigeonAllJsonInfo/);

5. æˆªåœ–è¦–è¦ºé©—è­‰ï¼ˆæœ€å¾Œæ‰‹æ®µï¼‰
   await expect(page).toHaveScreenshot('trajectory.png');
```

**å½±éŸ¿ç¯„åœ**: TC-02-001 çš„ 2 å€‹æ¸¬è©¦

---

### Decision 4: åŠŸèƒ½ Bug è™•ç†ç­–ç•¥

**æ±ºç­–**: è¨˜éŒ„ç‚ºå·²çŸ¥å•é¡Œï¼Œæ¨™è¨˜æ¸¬è©¦ç‚º `skip` æˆ– `known-issue`ï¼Œç¹¼çºŒä¿®å¾©å…¶ä»–å¯ä¿®å¾©çš„æ¸¬è©¦

**ç†ç”±**:
1. **å°ˆæ³¨æ–¼å¯æ§ç¯„åœ**: æ¸¬è©¦ä¿®å¾©å°ˆæ¡ˆä¸æ‡‰è©²é˜»å¡åœ¨åŠŸèƒ½ bug
2. **é€æ˜åŒ–**: è©³ç´°è¨˜éŒ„å•é¡Œï¼Œä¾¿æ–¼é–‹ç™¼åœ˜éšŠè·Ÿé€²
3. **é€²åº¦ä¿è­‰**: ç¢ºä¿å¯ä¿®å¾©çš„æ¸¬è©¦éƒ½å¾—åˆ°ä¿®å¾©

**è™•ç†æµç¨‹**:
```mermaid
graph TD
    A[ç™¼ç¾æ¸¬è©¦å¤±æ•—] --> B{ä¿®å¾© selector/timing å¾Œä»å¤±æ•—?}
    B -->|å¦| C[ä¿®å¾©æˆåŠŸ]
    B -->|æ˜¯| D{æ‰‹å‹•æ¸¬è©¦èƒ½é€šé?}
    D -->|æ˜¯| E[æ¸¬è©¦ä»£ç¢¼å•é¡Œ - ç¹¼çºŒä¿®å¾©]
    D -->|å¦| F[åŠŸèƒ½ Bug]
    F --> G[è¨˜éŒ„è©³ç´° Bug Report]
    G --> H[æ¨™è¨˜æ¸¬è©¦ç‚º skip/known-issue]
    H --> I[æ›´æ–° KNOWN_ISSUES_SOLUTIONS.md]
    I --> J[ç¹¼çºŒä¿®å¾©ä¸‹ä¸€å€‹æ¸¬è©¦]
```

**æ¨™è¨˜ç¯„ä¾‹**:
```typescript
test.skip('æ‡‰è©²æˆåŠŸåˆ‡æ›éœæ…‹â†’å‹•æ…‹â†’éœæ…‹ [KNOWN-ISSUE-#123]', async ({ page }) => {
  // æ¸¬è©¦ä»£ç¢¼
});
```

---

## ğŸ§­ æŠ€è¡“ä¾è³´é—œä¿‚

### getCurrentMode() å‡½æ•¸ä¾è³´éˆ

```
getCurrentMode() (navigation.ts:124)
    â†“ ç›´æ¥èª¿ç”¨
    â”œâ”€â†’ page.getByRole('button', { name: 'è¦–è§’1' })
    â”œâ”€â†’ page.getByRole('button', { name: /[23]Dæ¨¡å¼/ })
    â””â”€â†’ page.locator('.amap-container')

    â†“ è¢«ä»¥ä¸‹å‡½æ•¸èª¿ç”¨
    â”œâ”€â†’ ensureMode2D() (mode-switching.ts)
    â”œâ”€â†’ ensureMode3D() (mode-switching.ts)
    â””â”€â†’ switchMode() (å¯èƒ½å­˜åœ¨)

    â†“ è¢«ä»¥ä¸‹æ¸¬è©¦ä½¿ç”¨
    â”œâ”€â†’ TC-03-001: æ‡‰è©²æ­£ç¢ºåµæ¸¬ç•¶å‰æ¨¡å¼ (ç›´æ¥)
    â”œâ”€â†’ TC-04-001: æ‰€æœ‰ 6 å€‹ 3D æ¸¬è©¦ (é–“æ¥ via ensureMode3D)
    â””â”€â†’ TC-03-001: å…¶ä»– 4 å€‹æ¨¡å¼åˆ‡æ›æ¸¬è©¦ (é–“æ¥)
```

### æ¸¬è©¦åŸ·è¡Œä¾è³´

```
æ‰€æœ‰ P0 æ¸¬è©¦
    â†“ ä¾è³´
    â”œâ”€â†’ reload2DTrajectory() âœ… (å·²ä¿®å¾© - 100% é‹ä½œ)
    â”œâ”€â†’ getCurrentMode() âš ï¸ (Phase 1 ä¿®å¾©ç›®æ¨™)
    â”œâ”€â†’ waitForMapTiles()
    â”œâ”€â†’ waitForCesiumReady()
    â””â”€â†’ enterRace() / selectPigeon() / openTrajectory()
```

### å¤–éƒ¨ä¾è³´

```
æ¸¬è©¦ç’°å¢ƒ
    â”œâ”€â†’ Playwright ^1.40.0
    â”œâ”€â†’ TypeScript ^5.0.0
    â””â”€â†’ Node.js (ç‰ˆæœ¬å¾…ç¢ºèª)

æ¸¬è©¦ç›®æ¨™ç¶²ç«™
    â”œâ”€â†’ https://skyracing.com.cn (ç”Ÿç”¢ç’°å¢ƒ)
    â”œâ”€â†’ éœ€è¦ç¶²è·¯é€£æ¥ï¼ˆåœ°åœ–ç“¦ç‰‡åŠ è¼‰ï¼‰
    â””â”€â†’ API ç«¯é»:
        â”œâ”€ /ugetPublicRaceList
        â”œâ”€ /ugetPigeonAllJsonInfo â† æœ€é—œéµ
        â””â”€ /ugetTrackInfoByRank
```

---

## ğŸ“Š é—œéµæ•¸æ“šèˆ‡åŸºç·š

### æ¸¬è©¦é€šéç‡åŸºç·š

```
ä¿®å¾©å‰ (2025-11-21):
- ç¸½æ¸¬è©¦æ•¸: 16 å€‹ P0 æ¸¬è©¦
- é€šé: 2 å€‹ (12.5%)
  - TC-02-001: æ‡‰è©²é¡¯ç¤ºå®Œæ•´çš„è»Œè·¡ç·š âœ“
  - TC-02-001: æ‡‰è©²ç„¡æ§åˆ¶å°éŒ¯èª¤ âœ“
- å¤±æ•—: 14 å€‹ (87.5%)
- å°èˆªå¤±æ•—: 0 å€‹ (reload2DTrajectory å·²ä¿®å¾©)
```

### é æœŸæ”¹å–„è»Œè·¡

```
Phase 1 å®Œæˆå¾Œ:
- é æœŸé€šé: 10/16 (62.5%)
- æ–°å¢é€šé: +8 tests
  - getCurrentMode() æª¢æ¸¬æ¸¬è©¦ âœ“
  - 6 å€‹ 3D æ¨¡å¼æ¸¬è©¦ âœ“
  - å¯èƒ½çš„é€£é–æ•ˆæ‡‰ +1

Phase 2 å®Œæˆå¾Œ:
- é æœŸé€šé: 12/16 (75%)
- æ–°å¢é€šé: +2 tests
  - Timeline button æ¸¬è©¦ âœ“
  - Marker detection æ¸¬è©¦ âœ“

Phase 3 å®Œæˆå¾Œ:
- ä¿å®ˆä¼°è¨ˆ: 14/16 (87.5%)
- ç†æƒ³ç›®æ¨™: 16/16 (100%)
- æ–°å¢é€šé: +2 to +4 tests
```

### æ€§èƒ½åŸºç·š

```
reload2DTrajectory åŸ·è¡Œæ™‚é–“:
- å¹³å‡: 15-20 ç§’
- åœ°åœ–ç“¦ç‰‡æ•¸: 139 (ç©©å®š)
- Canvas åœ–å±¤: 1 (ç©©å®š)

å®Œæ•´ P0 æ¸¬è©¦å¥—ä»¶:
- é ä¼°ç¸½æ™‚é–“: ~10 åˆ†é˜
- ä¸æ‡‰å› ä¿®å¾©è€Œé¡¯è‘—å¢åŠ ï¼ˆ<20%ï¼‰
```

---

## ğŸ” å·²çŸ¥é™åˆ¶èˆ‡å‡è¨­

### å·²çŸ¥é™åˆ¶

1. **ç¶²è·¯ä¾è³´**: æ¸¬è©¦éœ€è¦ç©©å®šçš„ç¶²è·¯é€£æ¥ï¼ˆåœ°åœ–ç“¦ç‰‡åŠ è¼‰ï¼‰
2. **æ¸¬è©¦æ•¸æ“š**: ä¾è³´ç”Ÿç”¢ç’°å¢ƒçš„å¯¦éš›è³½äº‹æ•¸æ“šï¼ˆå¯èƒ½è®ŠåŒ–ï¼‰
3. **æ™‚é–“æ•æ„Ÿ**: æŸäº›æ¸¬è©¦å¯èƒ½å°åŸ·è¡Œæ™‚é–“æ•æ„Ÿï¼ˆéœ€èª¿æ•´ timeoutï¼‰
4. **ç€è¦½å™¨ç‰¹å®š**: ä¸»è¦æ¸¬è©¦ Chromeï¼Œå…¶ä»–ç€è¦½å™¨æœªå®Œå…¨é©—è­‰

### å‡è¨­

1. âœ… **reload2DTrajectory ç©©å®š**: å‡è¨­å°èˆªå•é¡Œå·²å¾¹åº•è§£æ±ºï¼ˆæœ‰æ¸¬è©¦è­‰æ“šæ”¯æŒï¼‰
2. âœ… **API ç©©å®š**: å‡è¨­å¾Œç«¯ API éŸ¿æ‡‰æ ¼å¼ä¸è®Š
3. âš ï¸ **UI çµæ§‹ç©©å®š**: å‡è¨­å‰ç«¯ DOM çµæ§‹åœ¨ä¿®å¾©æœŸé–“ä¸è®Šï¼ˆé¢¨éšªï¼šå¦‚æœç¶²ç«™æ›´æ–°ï¼‰
4. âš ï¸ **getCurrentMode() æ˜¯å”¯ä¸€æ ¹å› **: å‡è¨­ 7 å€‹å¤±æ•—æ¸¬è©¦éƒ½æ˜¯å› ç‚ºæ¨¡å¼æª¢æ¸¬å•é¡Œ

### é©—è­‰æ–¹æ³•

```bash
# é©—è­‰å‡è¨­ 1: reload2DTrajectory ç©©å®š
npm run test:p0 2>&1 | grep "âœ… 2D è»Œè·¡åŠ è¼‰æˆåŠŸ"

# é©—è­‰å‡è¨­ 2: API ç©©å®š
npx playwright test --grep "ugetPigeonAllJsonInfo"

# é©—è­‰å‡è¨­ 3: UI çµæ§‹
# æ‰‹å‹•æª¢æŸ¥ç¶²ç«™æ˜¯å¦æœ‰æ›´æ–°ï¼ˆæª¢æŸ¥ç‰ˆæœ¬è™Ÿæˆ–æ›´æ–°æ—¥æœŸï¼‰

# é©—è­‰å‡è¨­ 4: ä¿®å¾©å¾Œé‹è¡Œæ¸¬è©¦
npm run test:p0 | grep "TC-04-001"
```

---

## ğŸ“ å­¸ç¿’èˆ‡æœ€ä½³å¯¦è¸

### å¾ reload2DTrajectory ä¿®å¾©å­¸åˆ°çš„ç¶“é©—

**æˆåŠŸç¶“é©—**:
1. âœ… **å¤šé‡å¾Œå‚™ç­–ç•¥**: è¿”å›æŒ‰éˆ• â†’ é‡æ–°é€²å…¥è³½äº‹
2. âœ… **è©³ç´°æ—¥èªŒ**: æ§åˆ¶å°è¼¸å‡ºå¹«åŠ©å¿«é€Ÿ debug
3. âœ… **ç©©å¥çš„éŒ¯èª¤è™•ç†**: æ¯å€‹æ­¥é©Ÿéƒ½æœ‰ try-catch
4. âœ… **ç›´æ¥æª¢æ¸¬**: æª¢æ¸¬è¡¨æ ¼å¯è¦‹æ€§æ¯”æª¢æ¸¬ canvas æ›´å¯é 

**æ‡‰ç”¨åˆ° getCurrentMode() ä¿®å¾©**:
- âœ… æ¡ç”¨ä¸‰å±¤æª¢æ¸¬ç­–ç•¥ï¼ˆé¡ä¼¼å¤šé‡å¾Œå‚™ï¼‰
- âœ… æ·»åŠ è©³ç´°çš„æ§åˆ¶å°æ—¥èªŒ
- âœ… æ¯å€‹æª¢æ¸¬æ­¥é©Ÿéƒ½æœ‰éŒ¯èª¤è™•ç†ï¼ˆ`.catch(() => false)`ï¼‰
- âœ… å„ªå…ˆæª¢æ¸¬æ˜ç¢ºçš„ UI å…ƒç´ ï¼ˆè¦–è§’æŒ‰éˆ•ï¼‰

### Selector æœ€ä½³å¯¦è¸

**å„ªå…ˆé †åº**:
```
1. data-testid (æœ€ç©©å¥ - éœ€èˆ‡é–‹ç™¼åœ˜éšŠå”èª¿)
2. Role + Accessible Name (èªç¾©åŒ–ï¼Œæ¨è–¦)
3. Text content (å¯è®€æ€§é«˜)
4. CSS class (è„†å¼±ï¼Œéœ€è¬¹æ…)
5. XPath (æœ€ä¸æ¨è–¦ï¼Œé›£ç¶­è­·)
```

**ç¯„ä¾‹**:
```typescript
// âœ… æ¨è–¦: Role-based
page.getByRole('button', { name: /timeline/i })

// âœ… å¯æ¥å—: Parent + Role
page.locator('.control-panel').getByRole('button', { name: /timeline/i })

// âš ï¸ è¬¹æ…ä½¿ç”¨: CSS class
page.locator('button.timeline-btn')

// âŒ é¿å…: è„†å¼±çš„ CSS
page.locator('div > div:nth-child(3) > button')
```

### ç­‰å¾…ç­–ç•¥æœ€ä½³å¯¦è¸

**æ¨è–¦æ¨¡å¼**:
```typescript
// âœ… æ¨è–¦: ç­‰å¾…ç‰¹å®šç‹€æ…‹
await page.waitForLoadState('networkidle');
await page.waitForSelector('[data-loaded="true"]');

// âœ… å¯æ¥å—: ç­‰å¾… API éŸ¿æ‡‰
await page.waitForResponse(/ugetPigeonAllJsonInfo/);

// âš ï¸ è¬¹æ…ä½¿ç”¨: å›ºå®šæ™‚é–“ï¼ˆåƒ…ä½œç‚ºé¡å¤–ç·©è¡ï¼‰
await page.waitForTimeout(1000); // ç”¨æ–¼ç­‰å¾…å‹•ç•«

// âŒ é¿å…: éé•·çš„å›ºå®šç­‰å¾…
await page.waitForTimeout(10000); // å¤ªé•·ï¼Œå½±éŸ¿æ¸¬è©¦é€Ÿåº¦
```

---

## ğŸš¨ é¢¨éšªè­¦ç¤º

### é«˜é¢¨éšªæ“ä½œ

1. **ä¿®æ”¹ getCurrentMode() é‚è¼¯**
   - é¢¨éšª: å¯èƒ½å½±éŸ¿æ‰€æœ‰æ¨¡å¼åˆ‡æ›åŠŸèƒ½
   - ç·©è§£: å®Œæ•´å‚™ä»½ + é€æ­¥é©—è­‰

2. **æ‰¹æ¬¡ä¿®æ”¹ Selector**
   - é¢¨éšª: å¯èƒ½å¼•å…¥æ–°çš„å¤±æ•—
   - ç·©è§£: æ¯å€‹ä¿®æ”¹å¾Œç«‹å³é©—è­‰

3. **èª¿æ•´ç­‰å¾…æ™‚é–“**
   - é¢¨éšª: å¯èƒ½å°è‡´æ¸¬è©¦è®Šæ…¢æˆ–ä»ç„¶ä¸ç©©å®š
   - ç·©è§£: è¨˜éŒ„åŸå§‹å€¼ï¼Œæ¸¬è©¦å¤šæ¬¡ç¢ºèª

### å›æ»¾è§¸ç™¼æ¢ä»¶

**ç«‹å³å›æ»¾å¦‚æœ**:
- [ ] ä¿®å¾©å¾Œæ¸¬è©¦é€šéç‡**ä¸‹é™**
- [ ] æ–°å¼•å…¥çš„å¤±æ•—æ•¸é‡ > ä¿®å¾©çš„æ¸¬è©¦æ•¸é‡
- [ ] æ¸¬è©¦åŸ·è¡Œæ™‚é–“å¢åŠ  > 50%
- [ ] ç„¡æ³•åœ¨é™å®šæ™‚é–“å…§è§£æ±ºå•é¡Œ

**å›æ»¾æŒ‡ä»¤**:
```bash
# å›æ»¾æ‰€æœ‰ä¿®æ”¹
git checkout -- tests/helpers/navigation.ts
git checkout -- tests/e2e/tc-02-001-2d-static.spec.ts
git checkout -- tests/e2e/tc-03-001-mode-switch.spec.ts

# æˆ–ä½¿ç”¨å‚™ä»½
cp tests/helpers/navigation.ts.backup tests/helpers/navigation.ts

# é©—è­‰å›æ»¾
npm run test:p0
```

---

## ğŸ“ˆ é€²åº¦è¿½è¹¤

### åŸ·è¡Œæ™‚é–“è¨˜éŒ„

| éšæ®µ | é è¨ˆé–‹å§‹ | é è¨ˆå®Œæˆ | å¯¦éš›é–‹å§‹ | å¯¦éš›å®Œæˆ | å¯¦éš›è€—æ™‚ | ç‹€æ…‹ |
|------|---------|---------|---------|---------|---------|------|
| Phase 1 | 15:00 | 16:00 | 11-24 | 11-25 11:07 | ~90 min | âœ… Completed |
| Phase 2 | 16:00 | 16:40 | ________ | ________ | ________ | â³ Ready |
| Phase 3 | 17:00 | 18:40 | ________ | ________ | ________ | â³ Pending |

### æª¢æŸ¥é»è¨˜éŒ„

**Phase 1 æª¢æŸ¥é»**:
- [ ] å‚™ä»½å·²å‰µå»º: `navigation.ts.backup`
- [ ] ä»£ç¢¼å·²ä¿®æ”¹: `getCurrentMode()` å‡½æ•¸
- [ ] å–®å…ƒæ¸¬è©¦é€šé: TC-03-001:144
- [ ] é›†æˆæ¸¬è©¦é€šé: TC-04-001 æ‰€æœ‰æ¸¬è©¦
- [ ] é€šéç‡é”æ¨™: â‰¥ 62.5%
- [ ] ä»£ç¢¼å·²æäº¤: Git commit

**Phase 2 æª¢æŸ¥é»**:
- [ ] Selector èª¿æŸ¥å®Œæˆ: Timeline button
- [ ] Selector èª¿æŸ¥å®Œæˆ: Marker detection
- [ ] ä»£ç¢¼å·²ä¿®æ”¹: `tc-02-001-2d-static.spec.ts`
- [ ] æ¸¬è©¦é€šé: TC-02-001 æ‰€æœ‰æ¸¬è©¦
- [ ] é€šéç‡é”æ¨™: â‰¥ 75%
- [ ] ä»£ç¢¼å·²æäº¤: Git commit

**Phase 3 æª¢æŸ¥é»**:
- [ ] éŒ¯èª¤è¨Šæ¯å·²æ”¶é›†: æ‰€æœ‰å¤±æ•—æ¸¬è©¦
- [ ] å•é¡Œå·²åˆ†é¡: Selector/Timing/Logic/Bug
- [ ] ç°¡å–®å•é¡Œå·²ä¿®å¾©: â‰¥ 2 å€‹æ¸¬è©¦
- [ ] è¤‡é›œå•é¡Œå·²è¨˜éŒ„: `KNOWN_ISSUES_SOLUTIONS.md`
- [ ] é€šéç‡é”æ¨™: â‰¥ 87.5% æˆ– â‰¥ 75% + å•é¡Œå·²è¨˜éŒ„
- [ ] ä»£ç¢¼å·²æäº¤: Git commit

---

## ğŸ”— å¿«é€Ÿåƒè€ƒé€£çµ

### æœ¬åœ°æª”æ¡ˆè·¯å¾‘

```bash
# ä¸»è¦ä¿®æ”¹æª”æ¡ˆ
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/tests/helpers/navigation.ts
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/tests/e2e/tc-02-001-2d-static.spec.ts
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/tests/e2e/tc-03-001-mode-switch.spec.ts

# åƒè€ƒæ–‡æª”
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/docs/test-plan/KNOWN_ISSUES_SOLUTIONS.md
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/docs/guides/mode-switching.md
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/dev/æ¸¬è©¦è¨ˆåŠƒä¿®å¾©ä½œæ¥­1121/FIX_PLAN.md

# å·¥ä½œç›®éŒ„
/Users/tf/Downloads/PIGEON_RACING_TEST_PROJECT/dev/active/test-plan-fix/
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æ¸¬è©¦åŸ·è¡Œ
npm run test:p0
npx playwright test tests/e2e/tc-03-001-mode-switch.spec.ts:144
npx playwright test tests/e2e/tc-04-001-3d-mode.spec.ts
npx playwright test tests/e2e/tc-02-001-2d-static.spec.ts --debug

# å ±å‘ŠæŸ¥çœ‹
npx playwright show-report

# æª”æ¡ˆæ“ä½œ
cp tests/helpers/navigation.ts tests/helpers/navigation.ts.backup
diff tests/helpers/navigation.ts tests/helpers/navigation.ts.backup

# Git æ“ä½œ
git diff tests/helpers/navigation.ts
git add tests/helpers/navigation.ts
git commit -m "fix: ..."
```

---

## ğŸ’¡ é—œéµæ´å¯Ÿ

### ç‚ºä»€éº¼ getCurrentMode() æ˜¯é—œéµï¼Ÿ

1. **é«˜å½±éŸ¿åŠ›**: å½±éŸ¿ 7 å€‹æ¸¬è©¦ï¼ˆ43.75% çš„å¤±æ•—æ¸¬è©¦ï¼‰
2. **é€£é–åæ‡‰**: ä¿®å¾©å¾Œå¯èƒ½è§£é–å…¶ä»–æ¸¬è©¦
3. **æ ¹æœ¬åŸå› **: é‚è¼¯éŒ¯èª¤è€Œéç’°å¢ƒå•é¡Œï¼Œä¿®å¾©ç©©å®šæ€§é«˜
4. **ä½é¢¨éšª**: å‡½æ•¸é‚è¼¯æ¸…æ™°ï¼Œä¿®å¾©æ–¹æ¡ˆæ˜ç¢º

### ç‚ºä»€éº¼å„ªå…ˆ Phase 1ï¼Ÿ

| å› ç´  | Phase 1 | Phase 2 | Phase 3 |
|------|---------|---------|---------|
| **å½±éŸ¿æ¸¬è©¦æ•¸** | 7 | 2 | 4-5 |
| **ROI** | æœ€é«˜ (50%) | ä¸­ç­‰ (14%) | ä¸­ä½ (14-36%) |
| **ä¿®å¾©é›£åº¦** | ä¸­ | ä¸­ | ä¸­-é«˜ |
| **ç¢ºå®šæ€§** | é«˜ï¼ˆé‚è¼¯éŒ¯èª¤ï¼‰ | ä¸­ï¼ˆselectorå•é¡Œï¼‰ | ä½ï¼ˆå¯èƒ½æœ‰åŠŸèƒ½bugï¼‰ |
| **æ™‚é–“** | 1 å°æ™‚ | 40 åˆ†é˜ | 1-2 å°æ™‚ |

**çµè«–**: Phase 1 æ˜¯æœ€ä½³çš„æ™‚é–“-æ•ˆç›Šæ¯”ï¼ˆ1å°æ™‚ â†’ +50%é€šéç‡ï¼‰

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2025-11-21
**ç¶­è­·è€…**: æ¸¬è©¦è‡ªå‹•åŒ–åœ˜éšŠ
