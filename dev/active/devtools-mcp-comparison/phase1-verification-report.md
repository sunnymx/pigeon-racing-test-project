# Phase 1 é©—è­‰å ±å‘Š

**æ—¥æœŸ**: 2025-11-28
**ç‹€æ…‹**: âœ… å®Œæˆ

---

## 1. äº’å‹•å¼é©—è­‰çµæœ

### 1.1 æ ¸å¿ƒ API æ¸¬è©¦

| API | æ¸¬è©¦ç‹€æ…‹ | çµæœèªªæ˜ |
|-----|---------|---------|
| `mcp__chrome-devtools__list_pages` | âœ… æˆåŠŸ | æˆåŠŸåˆ—å‡ºé é¢ï¼Œåˆå§‹é é¢ç‚º about:blank |
| `mcp__chrome-devtools__navigate_page` | âœ… æˆåŠŸ | æˆåŠŸå°èˆªè‡³ https://skyracing.com.cn/ |
| `mcp__chrome-devtools__take_snapshot` | âœ… æˆåŠŸ | æˆåŠŸå–å¾— a11y å¿«ç…§ï¼ŒåŒ…å«å®Œæ•´å…ƒç´ æ¨¹ |
| `mcp__chrome-devtools__click` | âœ… æˆåŠŸ | æˆåŠŸé»æ“Šã€Œé€²å…¥ã€æŒ‰éˆ•ï¼Œé€²å…¥è³½äº‹è©³æƒ…é  |

### 1.2 å¿«ç…§çµæ§‹åˆ†æ

**é¦–é å¿«ç…§ç‰¹é»**ï¼š
- åŒ…å« 464 å€‹å…ƒç´ ç¯€é»ï¼ˆuid=1_0 åˆ° uid=1_464ï¼‰
- æˆåŠŸè­˜åˆ¥æ‰€æœ‰ã€Œé€²å…¥ã€æŒ‰éˆ•ï¼ˆbutton roleï¼‰
- å…ƒç´ æ–‡å­—å¯é€éé›™å¼•è™Ÿæå–ï¼ˆå¦‚ "è¿›å…¥"ï¼‰
- åŒ…å«å¹´ä»½é¸æ“‡å™¨ï¼ˆcomboboxï¼‰ã€æœå°‹æ¡†ï¼ˆtextboxï¼‰ç­‰äº’å‹•å…ƒç´ 

**è³½äº‹è©³æƒ…é å¿«ç…§ç‰¹é»**ï¼š
- æ¨™é¡Œï¼šã€Œå®‡èˆªå…¬æ£š 2025å†³èµ›ã€
- åŒ…å«ã€ŒæŸ¥çœ‹è»Œè·¡ã€æŒ‰éˆ•ï¼ˆdisabled ç‹€æ…‹ï¼‰
- åŒ…å«æ¨¡å¼é¸æ“‡æŒ‰éˆ•ï¼ˆ3D checkboxï¼‰
- åŒ…å«ã€Œé€€å‡ºè³½äº‹ã€æŒ‰éˆ•

### 1.3 é‡åˆ°çš„å•é¡Œ

**ç„¡å•é¡Œ** - æ‰€æœ‰æ ¸å¿ƒ API é‹ä½œæ­£å¸¸ã€‚

---

## 2. å»ºç«‹çš„æª”æ¡ˆæ¸…å–®

| æª”æ¡ˆè·¯å¾‘ | è¡Œæ•¸ | èªªæ˜ |
|---------|------|------|
| `tests/shared/types.ts` | 72 | å…±ç”¨å‹åˆ¥å®šç¾© |
| `tests/helpers-devtools/devtools-core.ts` | 188 | æ ¸å¿ƒå·¥å…·å‡½æ•¸ |
| `tests/helpers-devtools/README.md` | - | æ¨¡çµ„èªªæ˜æ–‡æª” |

### 2.1 ç›®éŒ„çµæ§‹

```
tests/
â”œâ”€â”€ helpers-devtools/    âœ… å·²å»ºç«‹
â”‚   â”œâ”€â”€ devtools-core.ts (188 è¡Œ)
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ e2e-devtools/        âœ… å·²å»ºç«‹ï¼ˆç©ºï¼‰
â”œâ”€â”€ comparison/          âœ… å·²å»ºç«‹ï¼ˆç©ºï¼‰
â””â”€â”€ shared/              âœ… å·²å»ºç«‹
    â””â”€â”€ types.ts (72 è¡Œ)
```

---

## 3. devtools-core.ts åŠŸèƒ½èªªæ˜

### 3.1 å¯¦ä½œçš„å‡½æ•¸

| å‡½æ•¸åç¨± | åŠŸèƒ½ | åƒæ•¸ | è¿”å›å€¼ |
|---------|------|------|--------|
| `parseSnapshot()` | è§£æå¿«ç…§ç‚ºçµæ§‹åŒ–è³‡æ–™ | snapshotText | SnapshotElement \| null |
| `findElementByRole()` | æŒ‰è§’è‰²å°‹æ‰¾å…ƒç´  | snapshotText, role, namePattern? | string \| null |
| `findElementByText()` | æŒ‰æ–‡å­—å°‹æ‰¾å…ƒç´  | snapshotText, textPattern | string \| null |
| `findAllElementsByRole()` | å°‹æ‰¾æ‰€æœ‰åŒ¹é…è§’è‰²çš„å…ƒç´  | snapshotText, role | string[] |
| `hasElement()` | æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ | snapshotText, role, namePattern? | boolean |
| `getElementText()` | æå–å…ƒç´ æ–‡å­—å…§å®¹ | snapshotText, uid | string \| null |

### 3.2 ä½¿ç”¨ç¯„ä¾‹

```typescript
import { findElementByRole } from './devtools-core';

// å°‹æ‰¾ç¬¬ä¸€å€‹ã€Œé€²å…¥ã€æŒ‰éˆ•çš„ uid
const snapshot = await take_snapshot();
const uid = findElementByRole(snapshot, 'button', /é€²å…¥/);
// è¿”å›: "1_16"

// é»æ“Šè©²æŒ‰éˆ•
await click({ uid });
```

---

## 4. é¢¨éšªèˆ‡å°ç­–

### 4.1 å·²è­˜åˆ¥é¢¨éšª

| é¢¨éšª | å½±éŸ¿ç¨‹åº¦ | å°ç­– | ç‹€æ…‹ |
|------|---------|------|------|
| a11y å¿«ç…§è§£æè¤‡é›œåº¦ | ä¸­ | å·²å»ºç«‹ç°¡åŒ–ç‰ˆè§£æå™¨ï¼Œæ”¯æ´åŸºæœ¬æŸ¥è©¢ | âœ… å·²ç·©è§£ |
| Canvas å…ƒç´ ä¸åœ¨ a11y æ¨¹ | é«˜ | å°‡ä½¿ç”¨ `evaluate_script` æ“ä½œåœ°åœ–å…ƒç´  | ğŸ”„ å¾…é©—è­‰ |
| ç­‰å¾…ç­–ç•¥å·®ç•° | ä¸­ | è¨ˆåŠƒåœ¨ wait-utils.ts ä¸­å¯¦ä½œè¼ªè©¢æ©Ÿåˆ¶ | ğŸ“‹ å·²è¦åŠƒ |

### 4.2 æ–°ç™¼ç¾å„ªå‹¢

1. **å¿«ç…§å³æ™‚æ€§**ï¼šæ¯æ¬¡ `take_snapshot` éƒ½å–å¾—æœ€æ–°ç‹€æ…‹ï¼Œç„¡éœ€é¡å¤–ç­‰å¾…
2. **å…ƒç´ è­˜åˆ¥æ¸…æ™°**ï¼šuid ç³»çµ±æä¾›ç©©å®šçš„å…ƒç´ è­˜åˆ¥æ–¹å¼
3. **è§’è‰²èªç¾©è±å¯Œ**ï¼ša11y æ¨¹æä¾›è±å¯Œçš„èªç¾©è³‡è¨Šï¼ˆbuttonã€textboxã€combobox ç­‰ï¼‰

---

## 5. ä¸‹ä¸€éšæ®µå»ºè­°

### 5.1 Phase 2 å„ªå…ˆé †åº

å»ºè­°æŒ‰ä»¥ä¸‹é †åºå¯¦ä½œ Helper æ¨¡çµ„ï¼š

| é †åº | æ¨¡çµ„ | ç†ç”± |
|------|------|------|
| 1ï¸âƒ£ | `wait-utils.ts` | åŸºç¤è¨­æ–½ï¼Œå…¶ä»–æ¨¡çµ„éƒ½æœƒä¾è³´ |
| 2ï¸âƒ£ | `navigation.ts` | é€²å…¥è³½äº‹ã€é¸æ“‡é´¿å­ç­‰åŸºæœ¬æµç¨‹ |
| 3ï¸âƒ£ | `mode-switching.ts` | 2D/3D åˆ‡æ›é‚è¼¯ |
| 4ï¸âƒ£ | `trajectory-utils.ts` | è»Œè·¡æ“ä½œï¼ˆéœ€é©—è­‰ Canvas äº’å‹•ï¼‰ |
| 5ï¸âƒ£ | `trajectory-reload.ts` | ä¾è³´ navigation + mode-switching |
| 6ï¸âƒ£ | `loft-list.ts` | ç›¸å°ç¨ç«‹ï¼Œæœ€å¾Œå¯¦ä½œ |

### 5.2 Canvas äº’å‹•é©—è­‰

**å¿…é ˆç›¡å¿«é©—è­‰**ï¼š
- a11y å¿«ç…§æ˜¯å¦åŒ…å«è»Œè·¡æ¨™è¨˜é»ï¼Ÿ
- å¦‚æœä¸åŒ…å«ï¼Œ`evaluate_script` èƒ½å¦æ“ä½œ Canvas å…ƒç´ ï¼Ÿ
- å»ºè­°åœ¨ Phase 2.1 å»ºç«‹ `wait-utils.ts` å¾Œç«‹å³é€²è¡Œé©—è­‰

### 5.3 å»ºè­°çš„é©—è­‰æ­¥é©Ÿ

```typescript
// é€²å…¥è³½äº‹ â†’ é¸é´¿å­ â†’ é–‹å•Ÿè»Œè·¡ â†’ å–å¿«ç…§
// æª¢æŸ¥å¿«ç…§ä¸­æ˜¯å¦æœ‰ .amap-icon æˆ–ç›¸é—œå…ƒç´ 
const snapshot = await take_snapshot();
console.log(snapshot); // åˆ†ææ˜¯å¦åŒ…å«åœ°åœ–æ¨™è¨˜

// å¦‚æœä¸åŒ…å«ï¼Œå˜—è©¦ä½¿ç”¨ evaluate_script
await evaluate_script({
  function: `() => {
    const markers = document.querySelectorAll('.amap-icon > img');
    return markers.length;
  }`
});
```

---

## 6. ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥

### 6.1 éµå¾ªè¦ç¯„

âœ… TypeScript åš´æ ¼æ¨¡å¼
âœ… JSDoc è¨»è§£å®Œæ•´
âœ… å–®ä¸€æª”æ¡ˆè¡Œæ•¸ < 250 è¡Œ
âœ… å‘½åé¢¨æ ¼ä¸€è‡´ï¼ˆåƒè€ƒ Playwright helpersï¼‰

### 6.2 å¾…æ”¹é€²é …ç›®

1. **parseSnapshot() ç°¡åŒ–ç‰ˆ**ï¼šç•¶å‰å¯¦ä½œåƒ…æ”¯æ´å¹³é¢æŸ¥è©¢ï¼Œæœªè™•ç†æ¨¹ç‹€çµæ§‹
2. **éŒ¯èª¤è™•ç†**ï¼šå‡½æ•¸ç¼ºå°‘éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæª¢æŸ¥
3. **å–®å…ƒæ¸¬è©¦**ï¼šéœ€ç‚º devtools-core å»ºç«‹æ¸¬è©¦

---

## 7. ç¸½çµ

### âœ… å·²å®Œæˆ
- Chrome DevTools MCP æ ¸å¿ƒ API é©—è­‰
- ç›®éŒ„çµæ§‹å»ºç«‹
- shared/types.ts (72 è¡Œ)
- helpers-devtools/devtools-core.ts (188 è¡Œ)

### ğŸ“Š çµ±è¨ˆ
- **ç¸½ä»£ç¢¼è¡Œæ•¸**: 260 è¡Œ
- **é ä¼°å®Œæˆåº¦**: Phase 1 å®Œæˆ 100%
- **è€—æ™‚**: ~1 å°æ™‚ï¼ˆäº’å‹•å¼é©—è­‰ + ä»£ç¢¼å¯¦ä½œï¼‰

### ğŸ¯ ä¸‹ä¸€æ­¥
ç«‹å³é–‹å§‹ **Phase 2.1: å»ºç«‹ wait-utils.ts**ï¼Œä¸¦åŒæ­¥é©—è­‰ Canvas äº’å‹•å¯è¡Œæ€§ã€‚
