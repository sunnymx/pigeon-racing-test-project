# 使用者歷程記錄

**記錄日期**: 2025-12-02
**記錄方式**: DevTools MCP 互動式快照
**用途**: 後續切分為測試項目的基礎資料

---

## 概述

本文件記錄了一次完整的使用者操作歷程，涵蓋網站主要功能的探索和驗證。每個記錄點包含頁面狀態、DOM 結構、可用元素和互動方式。

---

## 歷程總覽

```
首頁 → 賽事詳情 → 2D靜態 → 2D動態 → 3D模式 → 多選鴿子 → 鴿舍列表 → 勾選清單 → 雷達模式
 #1       #2        #3        #4        #5       #6-8        #10        #11       #12
```

| 記錄點 | 頁面/狀態 | 主要功能 | 測試價值 |
|--------|----------|----------|----------|
| #1 | 首頁 - 賽事列表 | 搜尋、年份篩選、進入賽事 | P0 入口 |
| #2 | 賽事詳情 - 鴿子列表 | 鴿子選擇、查看軌跡 | P0 核心 |
| #3 | 2D 靜態軌跡 + InfoWindow | 軌跡顯示、點擊互動 | P0 核心 |
| #4 | 2D 動態模式 + 風場 | 動態播放、風場顯示 | P1 進階 |
| #5 | 3D 模式完整功能 | 視角、播放、顯示控制 | P0 核心 |
| #6-8 | 多選鴿子顯示 | 多軌跡同時顯示 | P1 進階 |
| #9 | 軌跡詳情 - 航點列表 | 航點選取、前往功能 | P1 進階 |
| #10 | 鴿舍列表 Tab | 鴿舍篩選、舍內搜尋 | P1 進階 |
| #11 | 勾選清單面板 | 清單管理、刪除操作 | P2 輔助 |
| #12 | 雷達模式 | 全賽事追蹤、里程碑 | P2 特殊 |

---

## 詳細記錄

### 記錄點 #1: 首頁 - 賽事列表

**頁面 URL**: `https://skyracing.com.cn/`
**頁面標題**: Skyracing GPS pigeon tracker

#### 頁面元素

| 區域 | 元素 | 選擇器參考 | 功能 |
|------|------|-----------|------|
| 側邊欄 | 搜尋框 | `textbox "搜尋賽事"` | 賽事關鍵字搜尋 |
| 側邊欄 | 年份選擇 | `combobox` with options 2020-2025 | 年份篩選 |
| 側邊欄 | 賽事卡片 | `button "進入"` | 進入賽事詳情 |
| 主區域 | 地圖 | `canvas.amap-layer` | 2D 地圖顯示 |
| 底部 | 時間軸 | UTC 時間刻度 | 時間範圍 |

#### 互動流程
1. 可選: 輸入搜尋關鍵字篩選賽事
2. 可選: 選擇年份篩選賽事
3. 點擊賽事卡片的「進入」按鈕

#### 測試檢查點
- [ ] 賽事列表正確載入
- [ ] 搜尋功能正常
- [ ] 年份篩選功能正常
- [ ] 點擊進入可進入賽事詳情

---

### 記錄點 #2: 賽事詳情 - 鴿子列表

**進入方式**: 首頁 → 點擊「進入」按鈕

#### 頁面元素

| 區域 | 元素 | 選擇器參考 | 功能 |
|------|------|-----------|------|
| 頂部 | 賽事標題 | `heading` level 2 | 顯示賽事名稱 |
| 頂部 | 退出賽事 | `button "退出赛事"` | 返回首頁 |
| 頂部 | 查看軌跡 | `button "查看轨迹"` | 進入軌跡頁面 |
| 頂部 | 2D/3D 偏好 | `button "2D"` or `button "3D"` | 設定模式偏好 |
| 頂部 | 雷達模式 | `button "雷达模式"` | 進入雷達模式 |
| 頂部 | 勾選清單 | `button "勾选清单 N"` | 展開已選清單 |
| 標籤 | 名次搜尋 | `tab "名次&环号搜寻"` | 預設標籤 |
| 標籤 | 鴿舍列表 | `tab "鸽舍列表"` | 切換鴿舍視圖 |
| 列表 | 搜尋框 | `textbox "請輸入環號"` | 環號搜尋 |
| 列表 | 查詢按鈕 | `button "查询环号"`, `button "查询名次"` | 執行查詢 |
| 列表 | 鴿子行 | `checkbox` + 排名 + 環號 | 選擇鴿子 |
| 列表 | 分頁 | `combobox "page select"` | 分頁導航 |

#### 互動流程
1. 勾選一隻或多隻鴿子
2. (可選) 點擊 2D/3D 按鈕設定偏好
3. 點擊「查看軌跡」

#### 測試檢查點
- [ ] 鴿子列表正確載入 (多頁)
- [ ] checkbox 可正常勾選/取消
- [ ] 勾選後「查看軌跡」按鈕啟用
- [ ] 環號搜尋功能正常
- [ ] 名次查詢功能正常

---

### 記錄點 #3: 2D 靜態軌跡 + InfoWindow

**進入方式**: 賽事詳情 → 選擇鴿子 → 查看軌跡 (2D 偏好)

#### 頁面元素

| 區域 | 元素 | 選擇器參考 | 功能 |
|------|------|-----------|------|
| 地圖 | 軌跡線 | Polyline (白色) | 飛行路線 |
| 地圖 | 軌跡標記 | `.amap-icon > img` | 軌跡點 (15-20個) |
| 地圖 | InfoWindow | `.amap-info-window` | 點擊後顯示資訊 |
| 右側 | 排名榜 | 表格 (名次/色號/環號/分速/海拔) | 即時排名 |
| 左下 | 功能按鈕 | 動態/靜態、風場、測量、選單、詳情 | 工具列 |
| 右下 | 模式切換 | `button "3D模式"` | 切換到 3D |
| 底部 | 時間軸 | UTC 時間刻度 | 時間範圍 |

#### InfoWindow 結構 (點擊軌跡點後)
```
┌─────────────────────────┐
│ 環號: 15-1004999        │
│ 時間: 08:10:02          │
│ 海拔: 62 m              │
│ 分速: 1500 m/min        │
└─────────────────────────┘
```

#### 互動流程
1. 點擊軌跡標記點
2. 查看 InfoWindow 資訊
3. 可切換動態/靜態模式
4. 可開啟風場顯示
5. 可使用測量工具

#### 測試檢查點
- [ ] 軌跡線正確渲染
- [ ] 軌跡標記點 >= 15 個
- [ ] 點擊標記顯示 InfoWindow
- [ ] InfoWindow 資料正確 (環號/時間/海拔/分速)
- [ ] 排名榜數據正確

---

### 記錄點 #4: 2D 動態模式 + 風場

**進入方式**: 2D 靜態 → 點擊「切換動態/靜態」按鈕

#### 頁面元素差異

| 元素 | 靜態模式 | 動態模式 |
|------|----------|----------|
| 軌跡標記 | 15-20 個 | 1-3 個 (動態) |
| 播放控制 | 無 | 有 (減速/播放/加速) |
| 鴿子圖標 | 靜態 | 沿軌跡移動 |

#### 風場功能
- 按鈕: `button description="查看风场"`
- 顯示: 風向箭頭覆蓋層
- 已知問題: 風場可能不完整顯示

#### 測量工具
- 按鈕: `button description="测量距离工具"`
- 操作: 點擊地圖拉出測量線
- 顯示: 公里數
- 取消: 按 ESC 後點擊垃圾桶 icon

#### 測試檢查點
- [ ] 模式切換成功 (標記數量變化)
- [ ] 播放控制按鈕出現
- [ ] 動畫正常播放
- [ ] 風場可開啟
- [ ] 測量工具可使用

---

### 記錄點 #5: 3D 模式完整功能

**進入方式**:
- 方式 A: 賽事詳情 → 設定 3D 偏好 → 查看軌跡
- 方式 B: 2D 模式 → 點擊「3D模式」按鈕

#### 頁面元素

| 區域 | 元素 | 選擇器參考 | 功能 |
|------|------|-----------|------|
| 地圖 | 3D 地球 | Cesium canvas | 3D 渲染 |
| 地圖 | 3D 軌跡線 | 白色立體線條 | 飛行路線 |
| 右側 | 視角控制 | `button "视角1"`, `button "视角2"` | 切換視角 |
| 右側 | 顯示控制 | 軌跡點/歸返軌跡/排名榜/時速表 | 顯示切換 |
| 右側 | 播放控制 | 減速/播放/加速 | 動畫控制 |
| 左下 | 選單按鈕 | `button description="賽事/軌跡選單"` | 返回選單 |
| 右下 | 模式切換 | `button "2D模式"` | 切換到 2D |

#### 3D 專屬控制

| 按鈕 | 選擇器 | 功能 |
|------|--------|------|
| 視角1 | `button "视角1"` | 預設視角 |
| 視角2 | `button "视角2"` | 替代視角 |
| 顯示軌跡點 | `button "显示轨迹点"` | 切換標記顯示 |
| 隱藏歸返軌跡 | `button "隐藏归返轨迹"` | 切換歸返路徑 |
| 隱藏排名榜 | `button "隐藏排名榜"` | 切換排名面板 |
| 隱藏時速表 | `button "隐藏时速表"` | 切換時速表 |

#### 檢測 3D 模式的方式
```typescript
// 正確: 檢查 Cesium 元素
await page.waitForSelector('[class*="cesium"]');
// 或檢查視角按鈕
await page.getByRole('button', { name: /[视視]角1/ });
```

#### 測試檢查點
- [ ] 3D 地球正確載入
- [ ] 軌跡線渲染正確
- [ ] 視角切換功能正常
- [ ] 各顯示控制按鈕正常
- [ ] 播放控制正常

---

### 記錄點 #6-8: 多選鴿子顯示

**操作流程**:
1. 返回賽事詳情
2. 勾選多隻鴿子 (測試: 10 隻)
3. 點擊「查看軌跡」
4. 觀察 2D/3D 多軌跡顯示

#### 多選觀察

| 項目 | 單選 | 多選 (10隻) |
|------|------|-------------|
| 排名榜 | 1 行 | 10 行 |
| 軌跡線 | 1 條 | 10 條 (不同顏色) |
| 軌跡詳情 | 單一鴿子 | 可切換鴿子 |

#### 已知問題
- **2D 偏好失效**: 設定 2D 偏好後，多選可能仍進入 3D
- **解決方式**: 進入後手動點擊「2D模式」按鈕切換

#### 測試檢查點
- [ ] 多選鴿子正確顯示
- [ ] 軌跡以不同顏色區分
- [ ] 排名榜顯示所有選中鴿子
- [ ] 可在軌跡詳情中切換查看

---

### 記錄點 #9: 軌跡詳情 - 航點列表

**進入方式**: 軌跡頁面 → 點擊「軌跡詳情」按鈕

#### 軌跡詳情面板結構

```
┌─────────────────────────────────┐
│ 軌跡詳情                    [X] │
├─────────────────────────────────┤
│ 公環號: 15-1004999              │
│ 起點時間: 2025-11-29 08:01:00   │
│ 終點時間: 2025-11-29 11:38:57   │
│ 持續時間: 03:37:57              │
├─────────────────────────────────┤
│ 平均分速: 1461 m/Min            │
│ 最高分速: 1620 m/Min            │
│ 平均高度: 77 m                  │
│ 最大高度: 127 m                 │
│ 實際距離: 59.3 km               │
│ 直線距離: 58.95 km              │
├─────────────────────────────────┤
│ 航點 │ 時間 │ 累積 │ 距離 │ ... │
│  1   │ ... │ ...  │ ...  │ ... │
│  2   │ ... │ ...  │ ...  │ ... │
│ [可選取範圍]                    │
│           [前往]                │
└─────────────────────────────────┘
```

#### 航點列表功能
- **選取範圍**: 可選擇一段航點範圍
- **前往按鈕**: 點擊後地圖聚焦到選取範圍
- **軌跡高亮**: 選取範圍在地圖上高亮顯示

#### 測試檢查點
- [ ] 軌跡詳情面板正確展開
- [ ] 飛行數據正確顯示
- [ ] 航點列表可滾動
- [ ] 可選取航點範圍
- [ ] 「前往」功能正常

---

### 記錄點 #10: 鴿舍列表 Tab

**進入方式**: 賽事詳情 → 點擊「鴿舍列表」標籤

#### 頁面元素

| 區域 | 元素 | 選擇器參考 | 功能 |
|------|------|-----------|------|
| 標籤 | 鴿舍列表 | `tab "鸽舍列表"` selected | 當前標籤 |
| 篩選 | 鴿舍選擇 | `combobox` with ~1800 options | 選擇鴿舍 |
| 篩選 | 環號搜尋 | `textbox "请输入该鸽舍内的环号"` | 舍內搜尋 |
| 列表 | 表頭 | 軌迹 / 排名 / 公環 | 欄位標題 |
| 列表 | 鴿子行 | `checkbox` + 排名 + 環號 | 選擇鴿子 |

#### 鴿舍選擇器
- 選項數量: ~1800+ 個鴿舍
- 選項格式: 純數字 (1, 3, 4, 6, 7...)
- 預設: 鴿舍 1

#### 測試檢查點
- [ ] Tab 切換正常
- [ ] 鴿舍選擇器載入選項
- [ ] 切換鴿舍後列表更新
- [ ] 舍內環號搜尋正常
- [ ] 可選擇鴿子並查看軌跡

---

### 記錄點 #11: 勾選清單面板

**進入方式**: 點擊「勾選清單 N」按鈕展開

#### 面板結構

```
┌─────────────────────────────────┐
│ 勾選清單 2                  [v] │
├─────────────────────────────────┤
│ 排名 │ 公環        │ 操作      │
│  1   │ 15-1004999  │ [刪除]    │
│      │ 舍号: 1578  │           │
│  2   │ 27-0162950  │ [刪除]    │
│      │ 舍号: 2127  │           │
├─────────────────────────────────┤
│         [全部刪除]              │
└─────────────────────────────────┘
```

#### 操作按鈕
| 按鈕 | 選擇器 | 功能 |
|------|--------|------|
| 展開/收起 | `button "勾选清单 N"` expandable | 切換面板 |
| 刪除單個 | `button "删除"` | 移除單隻鴿子 |
| 全部刪除 | `button "全部删除"` | 清空清單 |

#### 額外資訊
- 顯示鴿舍編號 (舍号: XXXX)

#### 測試檢查點
- [ ] 面板正確展開/收起
- [ ] 顯示已選鴿子列表
- [ ] 單個刪除功能正常
- [ ] 全部刪除功能正常
- [ ] 刪除後計數更新

---

### 記錄點 #12: 雷達模式

**進入方式**: 賽事詳情 → 點擊「雷達模式」按鈕

#### 12a: 確認對話框

```
┌─────────────────────────────────┐
│ 是否接換至雷達模式？            │
├─────────────────────────────────┤
│ 启用后将下载整场赛事的飞行轨迹，│
│ 预计需时约1-5分钟，平均消耗流量 │
│ 为100-300MB，请确认是否进行切换？│
├─────────────────────────────────┤
│     [取消]        [確定]        │
└─────────────────────────────────┘
```

#### 12b: 下載過程
- 顯示下載進度
- 可點擊取消中斷

#### 12c: 雷達模式介面

| 區域 | 元素 | 說明 |
|------|------|------|
| 時間軸 | 36+ 小時範圍 | 整場賽事時間 |
| 搜尋 | textbox + search icon | 搜尋鴿子 |
| 鴿子列表 | 卡片式列表 | 所有參賽鴿子 |
| 里程碑 | 50KM~300KM 統計 | 完成率和數量 |
| 控制 | 視角/播放/圖資 | 播放控制 |

#### 鴿子卡片結構
```
┌─────────────────────────┐
│ [+] 名次 1              │
│     最终名次 2262       │
│     24-1387587          │
│     0 m    0 m/min      │
└─────────────────────────┘
```

#### 距離里程碑
| 里程 | 顯示內容 |
|------|----------|
| 50KM | 完成率 % + 數量 |
| 100KM | 完成率 % + 數量 |
| 150KM | 完成率 % + 數量 |
| 200KM | 完成率 % + 數量 |
| 250KM | 完成率 % + 數量 |
| 300KM | 完成率 % + 數量 |

#### 測試檢查點
- [ ] 確認對話框正確顯示
- [ ] 取消可中斷操作
- [ ] 下載過程有進度顯示
- [ ] 雷達模式介面正確載入
- [ ] 鴿子列表顯示所有參賽者
- [ ] 距離里程碑統計正確
- [ ] 可搜尋特定鴿子
- [ ] 播放控制正常

---

## 測試項目建議切分

### 階段 1: 首頁探索 (4 檢查點)
- 1.1 賽事列表載入
- 1.2 搜尋功能
- 1.3 年份篩選
- 1.4 進入賽事

### 階段 2: 進入賽事 (4 檢查點)
- 2.1 鴿子列表載入
- 2.2 鴿子選擇 (checkbox)
- 2.3 環號/名次搜尋
- 2.4 查看軌跡按鈕

### 階段 3: 2D 軌跡 (6 檢查點)
- 3.1 軌跡線渲染
- 3.2 軌跡標記點 (>= 15)
- 3.3 InfoWindow 顯示
- 3.4 InfoWindow 數據正確
- 3.5 排名榜顯示
- 3.6 工具按鈕可用

### 階段 4: 2D 動態 (7 檢查點)
- 4.1 模式切換成功
- 4.2 標記數量變化 (1-3)
- 4.3 播放控制出現
- 4.4 動畫播放正常
- 4.5 風場開啟
- 4.6 測量工具
- 4.7 測量取消

### 階段 5: 3D 模式 (8 檢查點)
- 5.1 3D 地球載入
- 5.2 軌跡線渲染
- 5.3 視角1 切換
- 5.4 視角2 切換
- 5.5 軌跡點顯示/隱藏
- 5.6 歸返軌跡顯示/隱藏
- 5.7 排名榜顯示/隱藏
- 5.8 時速表顯示/隱藏

### 階段 6: 鴿舍列表 (4 檢查點)
- 6.1 Tab 切換
- 6.2 鴿舍選擇器載入
- 6.3 鴿舍切換
- 6.4 舍內搜尋

### 階段 7: 錯誤監控 (3 檢查點)
- 7.1 Console 無嚴重錯誤
- 7.2 網路請求成功
- 7.3 頁面無崩潰

---

## 發現的問題

### 問題 #1: 2D 軌跡首次載入失敗 (已知)
- **狀態**: 已知問題
- **解決方式**: 重新選擇鴿子或使用 3D→2D 切換

### 問題 #2: 2D 偏好設定失效 (新發現)
- **現象**: 設定 2D 偏好後，多選仍進入 3D
- **解決方式**: 進入後手動點擊「2D模式」切換

### 問題 #3: 風場顯示不完整
- **現象**: 風場可能只顯示部分區域
- **狀態**: 待確認是否為設計問題

---

## 相關文件

- [SITE_MAP.md](../../docs/information-architecture/SITE_MAP.md) - 網站結構
- [FEATURE_CATALOG.md](../../docs/archive/non-core-docs/features/FEATURE_CATALOG.md) - 功能目錄
- [user-journey-test-plan.md](./user-journey-test-plan.md) - 測試計劃

---

**記錄者**: Claude Code + DevTools MCP
**驗證狀態**: 已完成互動式記錄
