# 使用者歷程記錄 V2

**版本**: 2.6
**建立日期**: 2025-12-02
**更新日期**: 2025-12-12
**更新內容**: 記錄點 #05 (3D 模式) 測試開發完成

---

## 概述

本文件記錄完整的使用者操作歷程，作為自動化測試的規格基礎。每個記錄點包含：
- 頁面狀態與進入方式
- DOM 結構與選擇器
- 測試檢查點（分優先級）
- 已知問題與解決方案

---

## 歷程總覽

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 主流程                                                                       │
│ 首頁 → 賽事詳情 → 2D靜態 → 2D動態 → 3D模式 → 軌跡詳情                        │
│  #01      #02       #03       #04       #05       #06                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ 輔助功能                                                                     │
│ 多選鴿子 → 鴿舍列表 → 勾選清單 → 雷達模式                                    │
│    #07        #08        #09        #10                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│ 品質監控                                                                     │
│ 錯誤監控 #11 (貫穿所有階段)                                                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

| 記錄點 | 頁面/狀態 | 類型 | 優先級 | 測試項目數 | 狀態 |
|--------|----------|------|--------|-----------|------|
| **主流程** ||||||
| #01 | 首頁 - 賽事列表 | 入口 | P0 | 5 | ✅ 完成 |
| #02 | 賽事詳情 - 鴿子列表 | 核心 | P0 | 5 | ✅ 完成 |
| #03 | 2D 靜態軌跡 + InfoWindow | 核心 | P0 | 6 | ✅ 完成 |
| #04 | 2D 動態模式 + 風場 | 進階 | P1 | 7 | ✅ 完成 |
| #05 | 3D 模式完整功能 | 核心 | P0 | 8 | ✅ 完成 |
| #06 | 軌跡詳情 - 航點列表 | 核心 | P0 | 15 | 待開發 |
| **輔助功能** ||||||
| #07 | 多選鴿子顯示 | 進階 | P1 | 4 | 待開發 |
| #08 | 鴿舍列表 Tab | 進階 | P1 | 5 | 待開發 |
| #09 | 勾選清單面板 | 輔助 | P2 | 5 | 待開發 |
| #10 | 雷達模式 | 特殊 | P2 | 8 | 待開發 |
| **品質監控** ||||||
| #11 | 錯誤監控 | 監控 | P0 | 3 | 待開發 |

---

## 詳細記錄

---

### 記錄點 #01: 首頁 - 賽事列表 ✅

**頁面 URL**: `https://hungdev.skyracing.com.cn/`
**頁面標題**: Skyracing GPS pigeon tracker

#### 開發狀態

| 項目 | 狀態 |
|------|------|
| 測試檔案 | `tests/e2e/tc-01-001-homepage.spec.ts` |
| Helper | `tests/helpers/fixtures.ts` |
| 測試數量 | 5 個 (1.1~1.5) |
| 本地測試 | ✅ 5/5 passed |
| CI 測試 | ✅ 已部署 |
| 完成日期 | 2025-12-10 |

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 側邊欄 | 搜尋框 | `textbox "搜尋賽事"` | 賽事關鍵字搜尋 |
| 側邊欄 | 年份選擇 | `combobox` | 年份篩選 (2020-2025) |
| 側邊欄 | 賽事卡片 | `button "進入"` | 進入賽事詳情 |
| 主區域 | 地圖 | `canvas.amap-layer` | 2D 地圖顯示 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 | 狀態 |
|---|---------|--------|---------|------|
| 1.1 | 首頁載入 | P0 | 檢查頁面標題存在 | ✅ |
| 1.2 | 賽事卡片數量 | P0 | 檢查卡片數量 ≥ 10 | ✅ |
| 1.3 | 搜尋功能可用 | P1 | 搜尋框元素可見 | ✅ |
| 1.4 | 年份篩選可用 | P1 | 下拉選單可見 | ✅ |
| 1.5 | 進入賽事成功 | P0 | 點擊進入 → h2 標題出現 | ✅ |

---

### 記錄點 #02: 賽事詳情 - 鴿子列表 ✅

**進入方式**: 首頁 → 點擊「進入」按鈕

#### 開發狀態

| 項目 | 狀態 |
|------|------|
| 測試檔案 | `tests/e2e/tc-02-001-race-entry.spec.ts` |
| Helper | `tests/helpers/fixtures.ts` (setupRaceEntry) |
| 測試數量 | 5 個 (2.1~2.5) |
| 本地測試 | ✅ 5/5 passed |
| CI 測試 | ✅ 已部署 |
| 完成日期 | 2025-12-11 |

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 頂部 | 賽事標題 | `heading` level 2 | 顯示賽事名稱 |
| 頂部 | 退出賽事 | `button "退出赛事"` | 返回首頁 |
| 頂部 | 查看軌跡 | `button "查看轨迹"` | 進入軌跡頁面 |
| 頂部 | 2D/3D 偏好 | `button "2D"` / `button "3D"` | 設定模式偏好 |
| 頂部 | 雷達模式 | `button "雷达模式"` | 進入雷達模式 |
| 頂部 | 勾選清單 | `button "勾选清单 N"` | 展開已選清單 |
| 標籤 | 名次搜尋 | `tab "名次&环号搜寻"` | 預設標籤 |
| 標籤 | 鴿舍列表 | `tab "鸽舍列表"` | 切換鴿舍視圖 |
| 列表 | 環號搜尋 | `textbox "請輸入環號"` | 環號搜尋 |
| 列表 | 查詢按鈕 | `button "查询环号"` / `button "查询名次"` | 執行查詢 |
| 列表 | 鴿子行 | `checkbox` | 選擇鴿子 |
| 列表 | 分頁 | `combobox "page select"` | 分頁導航 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 | 狀態 |
|---|---------|--------|---------|------|
| 2.1 | 鴿子列表載入 | P0 | 檢查 checkbox 數量 > 0 | ✅ |
| 2.2 | 鴿子選擇 | P0 | 點擊 checkbox → 狀態變更 | ✅ |
| 2.3 | 環號搜尋 | P1 | 輸入環號 → 查詢 → 結果顯示 | ✅ |
| 2.4 | 名次查詢 | P1 | 輸入名次 → 查詢 → 結果顯示 | ✅ |
| 2.5 | 查看軌跡啟用 | P0 | 選擇鴿子 → 按鈕啟用 | ✅ |

#### 開發備註

- **Test 2.1**: 表格首行為表頭無 checkbox，改用計數驗證
- **Test 2.5**: 有多個「查看軌跡」按鈕，使用 `.first()` 選擇

#### 已知問題

- **2D 偏好設定**: 點擊「查看軌跡」前需確認 2D 偏好已選中
- **選擇器**: `getByRole('button', { name: '2D', exact: true })`

---

### 記錄點 #03: 2D 靜態軌跡 + InfoWindow ✅

**進入方式**: 賽事詳情 → 選擇鴿子 → 設定 2D 偏好 → 查看軌跡

#### 開發狀態

| 項目 | 狀態 |
|------|------|
| 測試檔案 | `tests/e2e/tc-03-001-2d-static.spec.ts` |
| Helper | `tests/helpers/fixtures.ts` (setup2DTrajectory), `tests/helpers/trajectory.ts` |
| 測試數量 | 6 個 (3.1~3.6) |
| 本地測試 | ✅ 6/6 passed |
| CI 測試 | ✅ 已部署 |
| 完成日期 | 2025-12-11 |

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 地圖 | 軌跡線 | Polyline (AMap) | 飛行路線 (白色) |
| 地圖 | 軌跡標記 | `.amap-icon > img` | 軌跡點 (≥15 個) |
| 地圖 | InfoWindow | `.amap-info-window` | 點擊後顯示資訊 |
| 地圖 | Canvas | `canvas.amap-layer` | AMap 圖層 |
| 右側 | 排名榜 | 表格 | 即時排名 |
| 左下 | 動態/靜態 | `button` (timeline icon) | 模式切換 |
| 左下 | 風場 | `button description="查看风场"` | 風場顯示 |
| 左下 | 測量 | `button description="测量距离工具"` | 測量工具 |
| 左下 | 詳情 | `button description="軌跡詳情"` | 軌跡詳情面板 |
| 右下 | 3D切換 | `button "3D模式"` | 切換到 3D |

#### InfoWindow 結構

```
┌─────────────────────────┐
│ 環號: 15-1004999        │
│ 時間: 08:10:02          │
│ 海拔: 62 m              │
│ 分速: 1500 m/min        │
└─────────────────────────┘
```

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 | 狀態 |
|---|---------|--------|---------|------|
| 3.1 | 軌跡視圖載入 | P0 | `canvas.amap-layer` 存在 | ✅ |
| 3.2 | 軌跡標記點 | P0 | `.amap-icon > img` 數量 ≥ 15 | ✅ |
| 3.3 | 標記點點擊 | P0 | 點擊 → InfoWindow 顯示 | ✅ |
| 3.4 | InfoWindow 數據 | P0 | 包含環號/時間/海拔/分速 | ✅ |
| 3.5 | 排名榜顯示 | P1 | 表格數據正確 | ✅ |
| 3.6 | 工具按鈕可用 | P1 | 各按鈕可點擊 | ✅ |

#### 已知問題

- **首次載入失敗**: 軌跡可能不顯示，需重新選擇鴿子
- **解決方案**: 使用 `reload2DTrajectory()` helper

---

### 記錄點 #04: 2D 動態模式 + 風場 ✅

**進入方式**: 2D 靜態 → 點擊 timeline 按鈕 (動態切換)

#### 開發狀態

| 項目 | 狀態 |
|------|------|
| 測試檔案 | `tests/e2e/tc-04-001-2d-dynamic.spec.ts` |
| Helper | `tests/helpers/fixtures.ts` (setup2DDynamicMode), `tests/helpers/mode-switching.ts` |
| 測試數量 | 7 個 (4.1~4.7) |
| 本地測試 | ✅ 7/7 passed |
| CI 測試 | ✅ 已部署 |
| 完成日期 | 2025-12-12 |

#### 開發備註

- **Test 4.5**: 2D 動態模式可能無快退按鈕，使用 `test.skip()` 處理
- **Test 4.6**: 風場偵測改用截圖比對方式，避免 DOM 選擇器不穩定

#### 模式差異

| 項目 | 靜態模式 | 動態模式 |
|------|----------|----------|
| 軌跡標記 | 15-20 個 | 1-3 個 |
| 播放控制 | 無 | 有 (減速/播放/加速) |
| 鴿子圖標 | 靜態 | 沿軌跡移動 |

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 控制 | 播放 | `button` (play_arrow) | 播放動畫 |
| 控制 | 暫停 | `button` (pause) | 暫停動畫 |
| 控制 | 快進 | `button` (fast_forward) | 加速播放 |
| 控制 | 快退 | `button` (fast_rewind) | 減速播放 |
| 工具 | 風場 | `button description="查看风场"` | 風場覆蓋層 |
| 工具 | 測量 | `button description="测量距离工具"` | 測量工具 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 | 狀態 |
|---|---------|--------|---------|------|
| 4.1 | 動態切換 | P0 | 標記數量變為 < 5 | ✅ |
| 4.2 | 播放按鈕 | P0 | play_arrow 按鈕存在 | ✅ |
| 4.3 | 暫停按鈕 | P0 | 播放後 pause 按鈕出現 | ✅ |
| 4.4 | 快進功能 | P1 | fast_forward 按鈕可用 | ✅ |
| 4.5 | 快退功能 | P1 | fast_rewind 按鈕可用 | ⏭️ (skip) |
| 4.6 | 風場開啟 | P1 | 風向箭頭覆蓋層顯示 | ✅ |
| 4.7 | 靜態切回 | P0 | 切回後標記 ≥ 15 | ✅ |

---

### 記錄點 #05: 3D 模式完整功能 ✅

**進入方式**:
- 方式 A: 賽事詳情 → 設定 3D 偏好 → 查看軌跡
- 方式 B: 2D 模式 → 點擊「3D模式」按鈕

#### 開發狀態

| 項目 | 狀態 |
|------|------|
| 測試檔案 | `tests/e2e/tc-05-001-3d-mode.spec.ts` |
| Helper | `tests/helpers/fixtures.ts` (setup3DTrajectory), `tests/helpers/mode-switching.ts` |
| 測試數量 | 9 個 (5.1~5.8 + 來回切換) |
| 本地測試 | ✅ 9/9 passed |
| CI 測試 | ✅ 已部署 |
| 完成日期 | 2025-12-12 |

#### 開發備註

- **Test 5.5-5.8**: 控制按鈕可能因版本差異不存在，使用 `test.skip()` 處理
- **3D 偵測**: 應用不暴露 `window.Cesium`，改用視角按鈕偵測
- **超時設定**: 3D 模式需較長超時（Cesium 初始化慢），CI 使用 5x 倍數

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 地圖 | Cesium | `.cesium-viewer` / `.cesium-widget` | 3D 渲染 |
| 右側 | 視角1 | `button "视角1"` | 預設視角 |
| 右側 | 視角2 | `button "视角2"` | 替代視角 |
| 右側 | 軌跡點 | `button "显示轨迹点"` | 顯示/隱藏 |
| 右側 | 歸返軌跡 | `button "隐藏归返轨迹"` | 顯示/隱藏 |
| 右側 | 排名榜 | `button "隐藏排名榜"` | 顯示/隱藏 |
| 右側 | 時速表 | `button "隐藏时速表"` | 顯示/隱藏 |
| 右側 | 播放控制 | play_arrow / fast_forward / fast_rewind | 動畫控制 |
| 右下 | 2D切換 | `button "2D模式"` | 切換到 2D |

#### 檢測 3D 模式

```typescript
// 正確方式: 檢查 Cesium 元素
await page.waitForSelector('[class*="cesium"]');
// 或檢查視角按鈕
await page.getByRole('button', { name: /[视視]角1/ });
```

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 | 狀態 |
|---|---------|--------|---------|------|
| 5.1 | 3D 切換 | P0 | Cesium 元素存在 | ✅ |
| 5.2 | Cesium 初始化 | P0 | `.cesium-viewer` 可見 | ✅ |
| 5.3 | 視角1 按鈕 | P0 | 按鈕可點擊 | ✅ |
| 5.4 | 視角2 按鈕 | P0 | 按鈕可點擊 | ✅ |
| 5.5 | 軌跡點顯示 | P1 | 切換功能正常 | ✅ |
| 5.6 | 歸返軌跡顯示 | P1 | 切換功能正常 | ✅ |
| 5.7 | 排名榜顯示 | P1 | 切換功能正常 | ✅ |
| 5.8 | 時速表顯示 | P1 | 切換功能正常 | ✅ |
| 附加 | 3D↔2D 來回切換 | P0 | 模式互切驗證 | ✅ |

---

### 記錄點 #06: 軌跡詳情 - 航點列表

**進入方式**: 軌跡頁面 → 點擊「軌跡詳情」按鈕 (`button description="軌跡詳情"`)
**實測驗證**: 2025-12-03 (6/6 passed)
**參考規格**: [trajectory-validator.spec.md](specs/trajectory-validator.spec.md)

#### 前置條件

> ⚠️ **重要**: 航點列表需點擊按鈕觸發渲染

1. 進入軌跡頁面
2. 點擊「軌跡詳情」按鈕
3. 等待航點列表渲染（檢查 🏁 出現）

#### 軌跡詳情面板結構

```
┌─────────────────────────────────┐
│ 軌跡詳情                    [X] │
├─────────────────────────────────┤
│ 公環號: 15-1004999              │  ← 摘要區
│ 起點時間: 2025-11-29 08:01:00   │
│ 終點時間: 2025-11-29 11:38:57   │
│ 持續時間: 03:37:57              │
├─────────────────────────────────┤
│ 平均分速: 1461 m/Min            │  ← 統計區
│ 最高分速: 1620 m/Min            │
│ 平均高度: 77 m                  │
│ 最大高度: 127 m                 │
│ 實際距離: 59.3 km               │
│ 直線距離: 58.95 km              │
├─────────────────────────────────┤
│ 航點 │ 時間 │ 累積 │ 距離 │ ... │  ← 航點列表
│  1   │ ... │ ...  │ ...  │ ... │
│  2   │ ... │ ...  │ ...  │ ... │
│  🏁  │ ... │ ...  │ ...  │ ... │  ← 終點航點
│ [可選取範圍]                    │
│           [前往]                │
└─────────────────────────────────┘
```

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 說明 |
|------|------|--------|------|
| 面板 | 容器 | `.info-container` | 主要數據容器 |
| 按鈕 | 開啟 | `button description="軌跡詳情"` | 觸發渲染 |
| 列表 | 航點 | `.info-container` 內文字節點 | TreeWalker 提取 |
| 終點 | 🏁 標記 | 文字節點 `🏁` | 終點航點標識 |

#### 終點航點 (🏁) 特殊處理

> ⚠️ 終點航點 DOM 結構與普通航點不同

```
普通航點: [航點號] [時間] [累積時間] [距離] [海拔] [速度]
終點航點: [🏁] [航點號] [時間] [累積時間] [距離] [海拔] [速度]
```

**解析方式**:
```typescript
const finishIndex = texts.findIndex(t => t === '🏁');
if (finishIndex !== -1) {
  const waypointNum = texts[finishIndex + 1];  // 86
  const time = texts[finishIndex + 2];          // 11:40:09
  const duration = texts[finishIndex + 3];      // 03:39:09
  const distance = texts[finishIndex + 4];      // 319.42
  const altitude = texts[finishIndex + 5];      // 56
  const speed = texts[finishIndex + 6];         // 0
}
```

#### 驗證策略

```
┌─────────────────────────────────────────────────────────────┐
│  Layer 1: 摘要數據健全性檢查 (Strategy A/B)                  │
│  ├── 策略 A: 數值邏輯驗證 (內部一致性)                       │
│  └── 策略 B: 數值範圍驗證 (領域合理性)                       │
├─────────────────────────────────────────────────────────────┤
│  Layer 2: 摘要與航點一致性驗證                               │
│  └── 摘要面板數據 vs 航點列表計算值                          │
├─────────────────────────────────────────────────────────────┤
│  Layer 3: 跨數據源比對 (Strategy C) [可選]                   │
│  └── 軌跡詳情 vs 排名榜 vs InfoWindow                        │
└─────────────────────────────────────────────────────────────┘
```

#### 測試檢查點

##### UI 互動驗證

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 6.1 | 面板展開 | P0 | `.info-container` 可見 |
| 6.2 | 摘要數據 | P0 | 公環號/時間/距離存在 |
| 6.3 | 航點列表 | P0 | 航點數量 > 0 |
| 6.4 | 終點標記 | P0 | 🏁 存在 |
| 6.5 | 前往功能 | P1 | 選取範圍 → 前往 → 地圖聚焦 |

##### 策略 A: 數值邏輯驗證 (P0)

| # | 驗證規則 | 說明 |
|---|---------|------|
| 6.6 | 最高分速 ≥ 平均分速 | 最大值必須 ≥ 平均值 |
| 6.7 | 最大高度 ≥ 平均高度 | 最大值必須 ≥ 平均值 |
| 6.8 | 實際距離 ≥ 直線距離 | 實際路徑必定 ≥ 直線 |
| 6.9 | 終點時間 > 起點時間 | 時序邏輯 |

##### 策略 B: 數值範圍驗證 (P1)

| # | 驗證項目 | 合理範圍 |
|---|---------|----------|
| 6.10 | 分速 | 800 ~ 2000 m/min |
| 6.11 | 高度 | 0 ~ 500 m |
| 6.12 | 距離 | 10 ~ 500 km |

##### Layer 2: 摘要與航點一致性驗證 (P0)

| # | 驗證項目 | 計算方式 | 容差 |
|---|---------|----------|------|
| 6.13 | 最高分速 | max(航點.speed) | 精確匹配 |
| 6.14 | 最大高度 | max(航點.altitude) | 精確匹配 |
| 6.15 | 實際距離 | 終點航點.distance | 精確匹配 |

#### 實測驗證記錄

**驗證日期**: 2025-12-03
**測試鴿子**: 27-0162950
**航點數量**: 86 (含終點)
**結果**: ✅ ALL PASSED (6/6)

| # | 驗證項目 | 摘要值 | 計算值 | 差異 | 容差 | 結果 |
|---|---------|--------|--------|------|------|------|
| 1 | 最高分速 | 1680 | 1680 | 0 | 精確 | ✅ |
| 2 | 最大高度 | 150 | 150 | 0 | 精確 | ✅ |
| 3 | 平均分速 | 1419 | 1453 | 34 | ±213 | ✅ |
| 4 | 平均高度 | 79 | 80 | 1 | ±8 | ✅ |
| 5 | 實際距離 | 319.42 | 319.42 | 0 | 精確 | ✅ |
| 6 | 持續時間 | 03:39:09 | 03:39:09 | 0 | 精確 | ✅ |

#### Helper 類別

**檔案**: `tests/helpers/trajectory-validator.ts`

```typescript
import { TrajectoryValidator } from '../helpers/trajectory-validator';

// 使用範例
const validator = new TrajectoryValidator(page);
const report = await validator.validate();
validator.printReport(report);
expect(report.passed).toBe(true);
```

---

### 記錄點 #07: 多選鴿子顯示

**進入方式**: 賽事詳情 → 勾選多隻鴿子 → 查看軌跡

#### 多選觀察

| 項目 | 單選 | 多選 (10隻) |
|------|------|-------------|
| 排名榜 | 1 行 | 10 行 |
| 軌跡線 | 1 條 | 10 條 (不同顏色) |
| 軌跡詳情 | 單一鴿子 | 可切換鴿子 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 7.1 | 多軌跡顯示 | P1 | 多條軌跡線存在 |
| 7.2 | 顏色區分 | P1 | 各軌跡顏色不同 |
| 7.3 | 排名榜更新 | P1 | 顯示所有選中鴿子 |
| 7.4 | 切換查看 | P1 | 軌跡詳情可切換 |

#### 已知問題

- **2D 偏好失效**: 多選可能仍進入 3D
- **解決方案**: 進入後手動點擊「2D模式」切換

---

### 記錄點 #08: 鴿舍列表 Tab

**進入方式**: 賽事詳情 → 點擊「鴿舍列表」標籤

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 標籤 | 鴿舍列表 | `tab "鸽舍列表"` | 當前標籤 |
| 篩選 | 鴿舍選擇 | `combobox` (~1800 options) | 選擇鴿舍 |
| 篩選 | 環號搜尋 | `textbox "请输入该鸽舍内的环号"` | 舍內搜尋 |
| 列表 | 鴿子行 | `checkbox` + 排名 + 環號 | 選擇鴿子 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 8.1 | Tab 切換 | P1 | 標籤狀態變更 |
| 8.2 | 鴿舍選擇器 | P1 | 選項數量 > 0 |
| 8.3 | 鴿舍切換 | P1 | 選擇後列表更新 |
| 8.4 | 舍內搜尋 | P1 | 輸入環號 → 結果過濾 |
| 8.5 | 選擇查看 | P1 | 選擇鴿子 → 查看軌跡 |

---

### 記錄點 #09: 勾選清單面板

**進入方式**: 點擊「勾選清單 N」按鈕展開

#### 面板結構

```
┌─────────────────────────────────┐
│ 勾選清單 2                  [v] │
├─────────────────────────────────┤
│ 排名 │ 公環        │ 操作      │
│  1   │ 15-1004999  │ [刪除]    │
│      │ 舍号: 1578  │           │
│  2   │ 27-0162950  │ [刪除]    │
│      │ 舍号: 2127  │           │
├─────────────────────────────────┤
│         [全部刪除]              │
└─────────────────────────────────┘
```

#### DOM 結構與選擇器

| 區域 | 元素 | 選擇器 | 功能 |
|------|------|--------|------|
| 按鈕 | 展開/收起 | `button "勾选清单 N"` | 切換面板 |
| 列表 | 刪除單個 | `button "删除"` | 移除單隻鴿子 |
| 底部 | 全部刪除 | `button "全部删除"` | 清空清單 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 9.1 | 面板展開 | P2 | 點擊 → 面板顯示 |
| 9.2 | 清單內容 | P2 | 顯示已選鴿子 |
| 9.3 | 單個刪除 | P2 | 刪除 → 列表更新 |
| 9.4 | 全部刪除 | P2 | 刪除 → 清單清空 |
| 9.5 | 計數更新 | P2 | 刪除後數字更新 |

---

### 記錄點 #10: 雷達模式

**進入方式**: 賽事詳情 → 點擊「雷達模式」按鈕

#### 10a: 確認對話框

```
┌─────────────────────────────────┐
│ 是否接換至雷達模式？            │
├─────────────────────────────────┤
│ 启用后将下载整场赛事的飞行轨迹，│
│ 预计需时约1-5分钟，平均消耗流量 │
│ 为100-300MB，请确认是否进行切换？│
├─────────────────────────────────┤
│     [取消]        [確定]        │
└─────────────────────────────────┘
```

#### 10b: 雷達模式介面

| 區域 | 元素 | 說明 |
|------|------|------|
| 時間軸 | 36+ 小時範圍 | 整場賽事時間 |
| 搜尋 | textbox + search icon | 搜尋鴿子 |
| 列表 | 卡片式列表 | 所有參賽鴿子 |
| 里程碑 | 50KM~300KM | 完成率和數量 |
| 控制 | 視角/播放/圖資 | 播放控制 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 10.1 | 確認對話框 | P2 | 對話框顯示 |
| 10.2 | 取消功能 | P2 | 取消 → 返回列表 |
| 10.3 | 下載進度 | P2 | 進度顯示 |
| 10.4 | 介面載入 | P2 | 雷達模式顯示 |
| 10.5 | 鴿子列表 | P2 | 卡片列表存在 |
| 10.6 | 里程碑統計 | P2 | 50KM~300KM 顯示 |
| 10.7 | 搜尋功能 | P2 | 輸入 → 結果過濾 |
| 10.8 | 播放控制 | P2 | 播放/暫停正常 |

---

### 記錄點 #11: 錯誤監控

**執行方式**: 貫穿所有測試階段，持續監控

#### 監控項目

| 區域 | 監控內容 | 說明 |
|------|---------|------|
| Console | JavaScript 錯誤 | 嚴重錯誤會導致測試失敗 |
| Network | 網路請求 | API 請求失敗監控 |
| Page | 頁面崩潰 | 未預期的頁面錯誤 |

#### 測試檢查點

| # | 檢查項目 | 優先級 | 驗證方式 |
|---|---------|--------|---------|
| 11.1 | Console 無嚴重錯誤 | P0 | 監控 console.error |
| 11.2 | 網路請求成功 | P0 | API 請求無 5xx 錯誤 |
| 11.3 | 頁面無崩潰 | P0 | 無未處理異常 |

#### Helper 類別

**檔案**: `tests/helpers/console-monitor.ts`

```typescript
import { ConsoleMonitor } from '../helpers/console-monitor';

// 使用範例
const monitor = new ConsoleMonitor(page);
monitor.start();
// ... 執行測試 ...
const errors = monitor.getErrors();
expect(errors.length).toBe(0);
```

---

## 測試項目切分總覽

| 記錄點 | 名稱 | 測試項目 | P0 | P1 | P2 | 狀態 |
|--------|------|----------|----|----|-----|------|
| **主流程** |||||||
| #01 | 首頁 | 5 | 3 | 2 | 0 | ✅ 完成 |
| #02 | 賽事詳情 | 5 | 3 | 2 | 0 | ✅ 完成 |
| #03 | 2D 靜態 | 6 | 4 | 2 | 0 | ✅ 完成 |
| #04 | 2D 動態 | 7 | 3 | 4 | 0 | ✅ 完成 |
| #05 | 3D 模式 | 8 | 4 | 4 | 0 | 待開發 |
| #06 | 軌跡詳情 | 15 | 9 | 6 | 0 | 待開發 |
| **輔助功能** |||||||
| #07 | 多選鴿子 | 4 | 0 | 4 | 0 | 待開發 |
| #08 | 鴿舍列表 | 5 | 0 | 5 | 0 | 待開發 |
| #09 | 勾選清單 | 5 | 0 | 0 | 5 | 待開發 |
| #10 | 雷達模式 | 8 | 0 | 0 | 8 | 待開發 |
| **品質監控** |||||||
| #11 | 錯誤監控 | 3 | 3 | 0 | 0 | 待開發 |
| **總計** | | **71** | **29** | **29** | **13** | **4/11** |

---

## 已知問題總覽

| # | 問題 | 狀態 | 解決方案 |
|---|------|------|---------|
| 1 | 2D 軌跡首次載入失敗 | 已知 | 使用 `reload2DTrajectory()` |
| 2 | 2D 偏好設定失效 (多選) | 已知 | 進入後點擊「2D模式」切換 |
| 3 | 風場顯示不完整 | 待確認 | - |
| 4 | 航點列表需觸發渲染 | 已知 | 點擊「軌跡詳情」按鈕 |

---

## 相關文件

- [trajectory-validator.spec.md](specs/trajectory-validator.spec.md) - 軌跡驗證詳細規格
- [SITE_MAP.md](../../docs/information-architecture/SITE_MAP.md) - 網站結構
- [user-journey-test-plan.md](./user-journey-test-plan.md) - 測試計劃

---

**記錄者**: Claude Code + DevTools MCP
**版本歷程**:
- V1.0 (2025-12-02): 初版記錄
- V2.0 (2025-12-10): 整合 trajectory-validator.spec.md，統一格式
- V2.2 (2025-12-10): 記錄點 #01 測試開發完成，新增狀態追蹤欄位
- V2.3 (2025-12-11): 記錄點 #02 測試開發完成，新增開發備註
- V2.4 (2025-12-11): 記錄點 #03, #04 測試開發完成
- V2.5 (2025-12-12): 補齊 #03, #04 開發狀態表格、測試檢查點狀態，統一文件格式
